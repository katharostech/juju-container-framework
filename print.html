<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js rust">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Lucky - A charming framework for Juju</title>
        
        <meta name="robots" content="noindex" />
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "rust" : "rust";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="overview.html">Overview</a></li><li class="chapter-item expanded "><a href="getting-started.html"><strong aria-hidden="true">1.</strong> Getting Started</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="lucky-development/index.html"><strong aria-hidden="true">2.</strong> Lucky Development</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="lucky-development/design.html"><strong aria-hidden="true">2.1.</strong> Design</a></li><li class="chapter-item expanded "><a href="lucky-development/building.html"><strong aria-hidden="true">2.2.</strong> Development</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="cli/lucky.html"><strong aria-hidden="true">3.</strong> Lucky CLI</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="cli/lucky/charm.html"><strong aria-hidden="true">3.1.</strong> charm</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="cli/lucky/charm/build.html"><strong aria-hidden="true">3.1.1.</strong> build</a></li><li class="chapter-item expanded "><a href="cli/lucky/charm/create.html"><strong aria-hidden="true">3.1.2.</strong> create</a></li></ol></li><li class="chapter-item expanded "><a href="cli/lucky/client.html"><strong aria-hidden="true">3.2.</strong> client</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="cli/lucky/client/set-status.html"><strong aria-hidden="true">3.2.1.</strong> set-status</a></li><li class="chapter-item expanded "><a href="cli/lucky/client/kv.html"><strong aria-hidden="true">3.2.2.</strong> kv</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="cli/lucky/client/kv/get.html"><strong aria-hidden="true">3.2.2.1.</strong> get</a></li><li class="chapter-item expanded "><a href="cli/lucky/client/kv/set.html"><strong aria-hidden="true">3.2.2.2.</strong> set</a></li></ol></li><li class="chapter-item expanded "><a href="cli/lucky/client/container.html"><strong aria-hidden="true">3.2.3.</strong> container</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="cli/lucky/client/container/image.html"><strong aria-hidden="true">3.2.3.1.</strong> image</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="cli/lucky/client/container/image/get.html"><strong aria-hidden="true">3.2.3.1.1.</strong> get</a></li><li class="chapter-item expanded "><a href="cli/lucky/client/container/image/set.html"><strong aria-hidden="true">3.2.3.1.2.</strong> set</a></li></ol></li><li class="chapter-item expanded "><a href="cli/lucky/client/container/apply-updates.html"><strong aria-hidden="true">3.2.3.2.</strong> apply-updates</a></li><li class="chapter-item expanded "><a href="cli/lucky/client/container/env.html"><strong aria-hidden="true">3.2.3.3.</strong> env</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="cli/lucky/client/container/env/get.html"><strong aria-hidden="true">3.2.3.3.1.</strong> get</a></li><li class="chapter-item expanded "><a href="cli/lucky/client/container/env/set.html"><strong aria-hidden="true">3.2.3.3.2.</strong> set</a></li></ol></li><li class="chapter-item expanded "><a href="cli/lucky/client/container/set-entrypoint.html"><strong aria-hidden="true">3.2.3.4.</strong> set-entrypoint</a></li><li class="chapter-item expanded "><a href="cli/lucky/client/container/set-command.html"><strong aria-hidden="true">3.2.3.5.</strong> set-command</a></li><li class="chapter-item expanded "><a href="cli/lucky/client/container/volume.html"><strong aria-hidden="true">3.2.3.6.</strong> volume</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="cli/lucky/client/container/volume/remove.html"><strong aria-hidden="true">3.2.3.6.1.</strong> remove</a></li><li class="chapter-item expanded "><a href="cli/lucky/client/container/volume/add.html"><strong aria-hidden="true">3.2.3.6.2.</strong> add</a></li><li class="chapter-item expanded "><a href="cli/lucky/client/container/volume/get.html"><strong aria-hidden="true">3.2.3.6.3.</strong> get</a></li></ol></li><li class="chapter-item expanded "><a href="cli/lucky/client/container/delete.html"><strong aria-hidden="true">3.2.3.7.</strong> delete</a></li><li class="chapter-item expanded "><a href="cli/lucky/client/container/port.html"><strong aria-hidden="true">3.2.3.8.</strong> port</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="cli/lucky/client/container/port/add.html"><strong aria-hidden="true">3.2.3.8.1.</strong> add</a></li><li class="chapter-item expanded "><a href="cli/lucky/client/container/port/remove.html"><strong aria-hidden="true">3.2.3.8.2.</strong> remove</a></li><li class="chapter-item expanded "><a href="cli/lucky/client/container/port/list.html"><strong aria-hidden="true">3.2.3.8.3.</strong> list</a></li></ol></li><li class="chapter-item expanded "><a href="cli/lucky/client/container/set-network.html"><strong aria-hidden="true">3.2.3.9.</strong> set-network</a></li></ol></li><li class="chapter-item expanded "><a href="cli/lucky/client/public-address.html"><strong aria-hidden="true">3.2.4.</strong> public-address</a></li><li class="chapter-item expanded "><a href="cli/lucky/client/private-address.html"><strong aria-hidden="true">3.2.5.</strong> private-address</a></li><li class="chapter-item expanded "><a href="cli/lucky/client/get-config.html"><strong aria-hidden="true">3.2.6.</strong> get-config</a></li><li class="chapter-item expanded "><a href="cli/lucky/client/port.html"><strong aria-hidden="true">3.2.7.</strong> port</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="cli/lucky/client/port/open.html"><strong aria-hidden="true">3.2.7.1.</strong> open</a></li><li class="chapter-item expanded "><a href="cli/lucky/client/port/close.html"><strong aria-hidden="true">3.2.7.2.</strong> close</a></li><li class="chapter-item expanded "><a href="cli/lucky/client/port/get-opened.html"><strong aria-hidden="true">3.2.7.3.</strong> get-opened</a></li></ol></li><li class="chapter-item expanded "><a href="cli/lucky/client/relation.html"><strong aria-hidden="true">3.2.8.</strong> relation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="cli/lucky/client/relation/get.html"><strong aria-hidden="true">3.2.8.1.</strong> get</a></li><li class="chapter-item expanded "><a href="cli/lucky/client/relation/set.html"><strong aria-hidden="true">3.2.8.2.</strong> set</a></li><li class="chapter-item expanded "><a href="cli/lucky/client/relation/list-units.html"><strong aria-hidden="true">3.2.8.3.</strong> list-units</a></li><li class="chapter-item expanded "><a href="cli/lucky/client/relation/list-ids.html"><strong aria-hidden="true">3.2.8.4.</strong> list-ids</a></li></ol></li><li class="chapter-item expanded "><a href="cli/lucky/client/leader.html"><strong aria-hidden="true">3.2.9.</strong> leader</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="cli/lucky/client/leader/get.html"><strong aria-hidden="true">3.2.9.1.</strong> get</a></li><li class="chapter-item expanded "><a href="cli/lucky/client/leader/set.html"><strong aria-hidden="true">3.2.9.2.</strong> set</a></li><li class="chapter-item expanded "><a href="cli/lucky/client/leader/is-leader.html"><strong aria-hidden="true">3.2.9.3.</strong> is-leader</a></li></ol></li><li class="chapter-item expanded "><a href="cli/lucky/client/random.html"><strong aria-hidden="true">3.2.10.</strong> random</a></li><li class="chapter-item expanded "><a href="cli/lucky/client/get-resource.html"><strong aria-hidden="true">3.2.11.</strong> get-resource</a></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Lucky - A charming framework for Juju</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        <a href="https://github.com/katharostech/lucky" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#overview" id="overview">Overview</a></h1>
<p>Lucky is a framework for writing <a href="https://jaas.ai/">Juju</a> charms. It is being designed specifically to support writing Docker-powered charms easily, but its use is not limited to Docker. We want Lucky to be as easy to use as possible and be very well documented. We will focus on putting the developer's experience first, starting small and adding features as they become necessary or useful.</p>
<h2><a class="header" href="#getting-started" id="getting-started">Getting Started</a></h2>
<p>See the <a href="./getting-started.html">Getting Started guide</a> to learn how to write your first Lucky charm. The guide will walk you through creating a charm for <a href="https://github.com/hackmdio/codimd">CodiMD</a>.</p>
<h2><a class="header" href="#development" id="development">Development</a></h2>
<p>Lucky is currently in Alpha. There are likely bugs and the documentation is still a work-in-progress, but you should still be able to use it to make charms.</p>
<h2><a class="header" href="#bugs-features-and-questions" id="bugs-features-and-questions">Bugs, Features, and Questions</a></h2>
<p>If you have any bug reports or feature requests you can create a <a href="https://tree.taiga.io/project/zicklag-lucky/issues">Taiga issue</a> and we'll see what we can do to help.</p>
<p>For questions or general discussion there is also a <a href="https://discourse.jujucharms.com/c/related-software/lucky">Lucky category</a> on the <a href="https://discourse.jujucharms.com">Juju forum</a>.</p>
<h1><a class="header" href="#getting-started-1" id="getting-started-1">Getting Started</a></h1>
<p>Welcome to the getting started guide for the Lucky charming framework. Here we will walk through the process of creating a charm for <a href="https://github.com/hackmdio/codimd">CodiMD</a>. This charm will provide an <code>http</code> interface, allowing you to hook it up to other charms such as <a href="https://jaas.ai/haproxy">HAProxy</a> for load balancing. The charm will also require a <code>pgsql</code> interface which we will use to connect the charm to a <a href="https://jaas.ai/postgresql">PostgreSQL</a> database charm.</p>
<p>You can find the entire source for the charm we will be writing in this tutorial <a href="https://github.com/katharostech/lucky/tree/master/docs/book/src/codimd-example-charm">here</a>.</p>
<h2><a class="header" href="#installing-required-tools" id="installing-required-tools">Installing Required Tools</a></h2>
<p>Before we get started, we are going to need some tools. Juju development is usually done on Linux and this guide will assume that you are working in a Linux environment. While it is possible to develop charms on Windows, if you already have a Juju cluster, it currently isn't the easiest way to get started.</p>
<p>If your workstation is a Windows machine, the easiest way to develop charms is in a Linux <a href="https://www.vagrantup.com/">Vagrant</a> machine. It is outside of the scope of this tutorial to detail how to setup a Linux Vagrant machine.</p>
<blockquote>
<p><strong>Note:</strong> If already have a Juju cluster and you have the Juju CLI setup on Windows, you should be able to develop charms on Windows without a VM, but you might require more setup in order to install the charm tools. Even if you don't install the charm tools, you can still develop your charm, you just won't be able to push it to the store.</p>
<p>This is not very tested yet. If you need help getting setup you can open a <a href="https://discourse.jujucharms.com/c/related-software/lucky">forum topic</a>.</p>
</blockquote>
<h3><a class="header" href="#juju" id="juju">Juju</a></h3>
<p>The first step is to setup a Juju development cluster. See the <a href="https://jaas.ai/docs/getting-started-with-juju">Juju getting started guide</a> for more information.</p>
<h3><a class="header" href="#charm-tools" id="charm-tools">Charm Tools</a></h3>
<p>The <a href="https://github.com/juju/charm-tools">charm tools</a> CLI is what we will use to push our charm to the charm store. It can be installed with its <a href="https://snapcraft.io/charm">snap</a>:</p>
<pre><code>sudo snap install charm --classic
</code></pre>
<p>You can skip installing the charm tools if you don't want to push charms to the store.</p>
<h3><a class="header" href="#lucky" id="lucky">Lucky</a></h3>
<p>Now we install Lucky itself. You can download Lucky from the GitHub <a href="https://github.com/katharostech/lucky/releases">releases</a> page. Lucky will eventually support at least the Snap package manager, but for now you can also use this one-liner to install Lucky:</p>
<pre><code>curl -L https://github.com/katharostech/lucky/releases/download/v0.1.0-alpha.1/lucky-linux-x86_64.tgz | sudo tar -xzC /usr/local/bin/
</code></pre>
<p>You can verify that the install worked:</p>
<pre><code>$ lucky --version
lucky v0.1.0-alpha.0
</code></pre>
<h2><a class="header" href="#creating-your-charm" id="creating-your-charm">Creating Your Charm</a></h2>
<p>Now that we have the required tools, we can create our charm. Lucky comes with a built-in charm template that you can use:</p>
<pre><code class="language-bash">$ lucky charm create codimd
Display name [codimd]: Codimd
Charm name [codimd]: 
Charm summary [A short summary of my app.]: A realtime collaborative notes platform.
Charm maintainer [John Doe &lt;johndoe@emailprovider.com&gt;]: My Name &lt;myname@myprovider.com&gt;
</code></pre>
<p>This will create a new dir named <code>codimd</code> with the metadata that you filled in and some example code.</p>
<h2><a class="header" href="#configuring-charm-metadata" id="configuring-charm-metadata">Configuring Charm Metadata</a></h2>
<p>Lets first take a look at that metadata:</p>
<h3><a class="header" href="#metadatayaml" id="metadatayaml"><code>metadata.yaml</code></a></h3>
<pre><code class="language-yaml">name: codimd
display-name: Codimd
summary: A realtime collaborative notes platform.
maintainer: My Name &lt;myname@myprovider.com&gt;
description: |
  A realtime collaborative notes platform.
tags:
  # Replace &quot;misc&quot; with one or more whitelisted tags from this list:
  # https://jujucharms.com/docs/stable/authors-charm-metadata
  - misc
subordinate: false
provides:
  provides-relation:
    interface: interface-name
requires:
  requires-relation:
    interface: interface-name
peers:
  peer-relation:
    interface: interface-name
</code></pre>
<p>That pretty much has what we need, but we will want to change those fake relations to the ones that we actually need. Go ahead and remove the <code>provides</code>, <code>requires</code>, and <code>peers</code> sections and replace them with this:</p>
<pre><code class="language-yaml">provides:
  website:
    interface: http
requires:
  database:
    interface: pgsql
</code></pre>
<p>With this we tell Juju that:</p>
<ul>
<li>we have a <code>website</code> relation that we <code>provide</code> and the way we interact with that relation conforms to the <code>http</code> interface.</li>
<li>we have a <code>database</code> relation that we <code>require</code> and the way we interact with that relation conforms to the <code>pgsql</code> interface.</li>
</ul>
<p>Interfaces are names for the way in which a charm will communicate over a relation. Only relations with the same interface will be allowed to be connected to each-other. This means there is no way to accidentally connect a requires <code>pgsql</code> relation to a charm that only provides <code>redis</code>.</p>
<p>You can find documentation for some interfaces in the <a href="https://discourse.jujucharms.com/c/docs/interfaces">Juju interfaces docs</a>.</p>
<p>Next we'll look at our config.</p>
<h3><a class="header" href="#configyaml" id="configyaml"><code>config.yaml</code></a></h3>
<p>The template config yaml looks like this:</p>
<pre><code class="language-yaml"># These are config values that users can set from the GUI or the commandline
options:
  name:
    type: string
    default: John
    description: The name of something
  enable-something:
    type: boolean
    default: False
    description: Whether or not to enable something
  count:
    type: int
    default: 100
    description: How much of something
</code></pre>
<p>The purpose of <code>config.yaml</code> is to define the options to our charm that users are allowed to change. We can see all of the available config options for CodiMD in their <a href="https://github.com/codimd/server/blob/master/docs/configuration-env-vars.md">documentation</a>. For now we'll just give some of the minimal essential options in our <code>config.yaml</code>. Also, note that we don't need to put the database connection info in the config because we will use Juju's relations to automatically configure the database connection.</p>
<pre><code class="language-yaml">options:
  domain:
    type: string
    default: example.org
    description: The domain CodiMD is hosted under
  url-path:
    type: string
    default: &quot;&quot;
    description: If CodiMD is run from a subdirectory like &quot;www.example.com/&lt;urlpath&gt;&quot;
  port:
    type: int
    default: 9000
    description: The port to host CodiMD on
  https:
    type: boolean
    default: false
    description: Whether or not the server will be accessed over HTTPS
</code></pre>
<p>That config will give us enough information for us to get started, but if we wanted to make a general-purpose charm for the community we would want to add the rest of the configuration from the documentation.</p>
<h3><a class="header" href="#luckyyaml" id="luckyyaml"><code>lucky.yaml</code></a></h3>
<p>The final metadata file we are interested in is the <code>lucky.yaml</code> file. This file acts as your &quot;control panel&quot; so to speak when it comes to the execution of your charm logic. The job of the <code>lucky.yaml</code> is to tell lucky <em>when</em> and <em>how</em> to execute your charm scripts. The charm template comes with an example <code>lucky.yaml</code> that shows you everything that you can put in a <code>lucky.yaml</code> file. For the sake of this tutorial we are going to take everything out of the <code>lucky.yaml</code> and build on it as we go.</p>
<p><strong>lucky.yaml:</strong></p>
<pre><code class="language-yaml"># Nothing here yet!
</code></pre>
<h2><a class="header" href="#writing-your-first-script" id="writing-your-first-script">Writing Your First Script</a></h2>
<p>Now we are ready to write our first script! In Lucky there are two kinds of scripts, host scripts and container scripts, which are put in the <code>host_scripts/</code> and <code>container_scripts/</code> directories. The difference is that host scripts run on the host and container scripts are mounted and run inside of your containers. Our scripts for CodiMD will go in the <code>host_scripts/</code> dir.</p>
<p>You will notice that there are some scripts from the charm template already in the <code>hosts_scripts/</code> and <code>container_scripts/</code> dirs. These are just examples and you can remove them for this tutorial.</p>
<p>The first script that we will create for our charm is the install script. Note that the name of the script is arbitrary and you could call it whatever you want.</p>
<p><strong>install.sh:</strong></p>
<pre><code class="language-bash">#!/bin/bash

# Exit script early if any command in the script fails
set -e

# Set the status for this script so users can se what our charm is doing
lucky set-status maintenance &quot;Starting CodiMD&quot;

# Set the Docker image, this will cause lucky to create a container when this
# script exits
lucky container image set quay.io/codimd/server:1.6.0-alpine

# Set a named status that can be changed from other scripts.
# Here we notify the user that we need a database relation before CodiMD will work
lucky set-status --name db-state blocked &quot;Waiting for database connection&quot; 

# Clear the status for this script by setting the status to active without a message.
# This makes sure that our &quot;Starting CodiMD&quot; message goes away.
lucky set-status active
</code></pre>
<p>First notice that we have a &quot;shabang&quot;, as it is called, at the top of the file: <code>#!/bin/bash</code>. This tells the system to execute our file with bash. We also include a <code>set -e</code>, which will make sure that he script will exit early if any of the commands in it fail. Additionally we need to make our file executable by running <code>chmod +x install.sh</code>. This makes sure that Lucky will be able to execute the script when the charm runs.</p>
<p>After that we use the <code>lucky set-status</code> command set the Juju status, which will be visible in the Juju GUI.</p>
<p>Then we set the Docker container image with the <code>lucky container image set</code> command. Setting a container's image is the way to create a new contianer that will be deployed by Lucky automatically when our script exits. Additionally, when we change any container configuration, such as environment variables or port bindings, Lucky will wait until our script exits and then apply any changes that we have made. We will see more of how this works later.</p>
<h3><a class="header" href="#understanding-lucky-status" id="understanding-lucky-status">Understanding Lucky Status</a></h3>
<p>At this point the Lucky status mechanism should be explained. In Lucky, when you call <code>set-status</code>, by default, Lucky will set the given status <em>for only that script</em>. This means that if another script uses <code>set-status</code> it will not overwrite the status that the previous script set, but will instead <em>add</em> its status to the previous status by comma separating the list of all script status messages.</p>
<p>It is common pattern in Lucky scripts to have a <code>lucky set status maintenance &quot;Message&quot;</code> at the top  of the script and a <code>lucky set-status active</code> at the bottom. This makes sure that the user will be notified of the script's action, and that the action message will be cleared before the script exits.</p>
<p>Alternatively, when you set a status with a <code>--name &lt;name&gt;</code>, you can set that status from <em>any</em> script by specifying the same <code>--name</code>. In this exmple, we use a status with a <code>db-state</code> name that we use to indicate the status of our database connection. When the charm is first installed, it will not have a database relation, and we use this opportunity to tell the user that we need a database connection to work. Later, when we get a database connection in a <em>different</em> script, we will call <code>lucky set-status --name db-state active</code> to clear the blocked status.</p>
<h3><a class="header" href="#adding-our-script-to-the-luckyyaml" id="adding-our-script-to-the-luckyyaml">Adding Our Script to the <code>lucky.yaml</code></a></h3>
<p>Ok, so we now have a written script, but currently there is nothing instructing Lucky to run the script at any time. The script existing is <em>not</em> enough to cause it to run. That is why we add entries to the <code>lucky.yaml</code>, to tell Lucky when to run our scripts.</p>
<p>In this case, we want our <code>install.sh</code> host script to run when the Juju <code>install</code> hook is triggered:</p>
<p><strong>lucky.yaml:</strong></p>
<pre><code class="language-yaml"># Juju hooks
hooks:
  
  # When the charm is installed
  install:
    # Run our install.sh host script
    - host-script: install.sh
</code></pre>
<p>Pretty simple right? Now Lucky will run our <code>install.sh</code> host script whenever the Juju <code>install</code> hook is run.</p>
<p>Lets move on to the <code>configure.sh</code> script.</p>
<h2><a class="header" href="#writing-the-configuresh-script" id="writing-the-configuresh-script">Writing the <code>configure.sh</code> Script</a></h2>
<p>So we have our app installing, and actually starting ( becuse Lucky will start the container when we set the docker image ) with the <code>install.sh</code> script, but it won't really do anything because it doesn't have any of our configuration. That is what we are going to do with our <code>configure.sh</code> script. We are going to read the configuration values that we have defined in our <code>config.yaml</code> and use those values to set environment variables on our CodiMD container.</p>
<p><strong>configure.sh:</strong></p>
<pre><code class="language-bash">#!/bin/bash

set -e

lucky set-status maintenance &quot;Configuring CodiMD&quot;

# Get the config values and put them in shell variables
domain=&quot;$(lucky get-config domain)&quot;
url_path=&quot;$(lucky get-config url-path)&quot;
https=&quot;$(lucky get-config https)&quot;
add_port=&quot;$(lucky get-config add-port-to-domain)&quot;
port=&quot;$(lucky get-config port)&quot;

# Set the respective container environment variables
lucky container env set \
    &quot;CMD_DOMAIN=$domain&quot; \
    &quot;CMD_URL_PATH=$url_path&quot; \
    &quot;CMD_PORT=$port&quot; \
    &quot;CMD_PROTOCOL_USESSL=$https&quot; \
    &quot;CMD_URL_ADDPORT=false&quot; # This last config fixes issues when hosting on different ports

# Remove any mounted container ports that might have been added in previous
# runs of `configure.sh`.
lucky container port remove --all

# Mount configured port on the host to configured port in the container
lucky container port add &quot;$port:$port&quot;

# Clear any previously opened firewall ports
lucky port close --all

# Open the configured port on the firewall
lucky port open $port

lucky set-status active
</code></pre>
<p>In this script we introduce some extra <code>lucky</code> commands. As always, you can access extra information on those commands in the <a href="./cli/lucky/client.html">Lucky client</a> documentation.</p>
<blockquote>
<p><strong>Note:</strong> You can also access the CLI documentation from the Lucky CLI itself, by prefixing the command that we use in our script with <code>client</code> and adding the <code>--doc</code> flag. For example, you can run <code>lucky client get-config --doc</code> on your workstation to get terminal rendered view of the same CLI documentation available on this site. This can be very useful when needing to quickly look something up without using a web browser or the internet.</p>
</blockquote>
<p>Overall this script is pretty simple, when the config changes, we make sure that our container environment variables are up-to-date. Also we make sure that we mount the configured port on the host to the container.</p>
<p>When working with ports that are opened according to configuration values, we need to make sure that we <em>remove</em> any ports that were opened by previous configuration. This makes sure that we don't end up with multiple ports mounted into the container if the user changes the configured port and the <code>configure.sh</code> script is re-run.</p>
<h3><a class="header" href="#the-difference-between-lucky-container-port-and-lucky-port" id="the-difference-between-lucky-container-port-and-lucky-port">The Difference Between <code>lucky container port</code> and <code>lucky port</code></a></h3>
<p>You may notice in the above example that we do both a <code>lucky container port add</code> and a <code>lucky port open</code>, so what is the difference?</p>
<p><code>lucky contianer port add</code> will add a port binding from the host to the container. <code>lucky port open</code>, on the other hand, registers that port with Juju so that it will be opened through the host's <em>firewall</em> when users run <code>juju expose codimd</code>.</p>
<p>If you want to be able to communicate to a port only on the private network, such as app-to-app communication, you do <strong>not</strong> want to use <code>lucky open</code> because that will expose that port to the internet on the host's firewall. In such a case you will still need to use <code>lucky contianer port add</code> to make sure that the containers can communicate.</p>
<p>If you <em>do</em> want to be able to hit the port from the internet, though, like in the case of CodiMD, you <em>will</em> need to <code>lucky open port</code> <em>and</em> the users will need to <code>juju expose</code> the application before you can access that port.</p>
<h3><a class="header" href="#adding-configuresh-to-the-luckyyaml" id="adding-configuresh-to-the-luckyyaml">Adding <code>configure.sh</code> to the <code>lucky.yaml</code></a></h3>
<p>Now we can add <code>configure.sh</code> to the <code>lucky.yaml</code> just like we did with the <code>install.sh</code> script.</p>
<pre><code class="language-yaml"># Juju hooks
hooks:
  
  # When the charm is installed
  install:
    # Run our install.sh host script
    - host-script: install.sh
  
  # When configuration has been changed
  config-changed:
    # Run our configure.sh host script
    - host-script: configure.sh 
</code></pre>
<h2><a class="header" href="#handling-the-database-relation" id="handling-the-database-relation">Handling the Database Relation</a></h2>
<p>OK, so we now have our app and its user configuration. The next step is to setup the database relation. We will use the database relationship in Juju to automatically configure our database connection when the user runs <code>juju relate codimd postgresql:db</code>.</p>
<p>We are going to create a new script for handling the database relation:</p>
<p><strong>handle-datbase-relation.sh:</strong></p>
<pre><code class="language-bash">#!/bin/bash

set -e

# Set the database name
db_name=codimd

# Here we match on the first argument ( $1 ) passed in from the lucky.yaml

if [ &quot;$1&quot; = &quot;join&quot; ]; then
    lucky set-status --name db-state maintenance &quot;Connecting to database&quot;

    # Set the name of the database that we want the server to create for us
    lucky relation set &quot;database=$db_name&quot;

elif [ &quot;$1&quot; = &quot;update&quot; ]; then
    lucky set-status --name db-state maintenance &quot;Updating database connection&quot;

    # Get the values from the connected database relation
    dbhost=&quot;$(lucky relation get host)&quot;
    dbport=&quot;$(lucky relation get port)&quot;
    dbuser=&quot;$(lucky relation get user)&quot;
    dbpassword=&quot;$(lucky relation get password)&quot;

    # If any of those values have not be set yet, exit early and wait until next update
    if [ &quot;$dbhost&quot; = &quot;&quot; -o &quot;$dbport&quot; = &quot;&quot; -o &quot;$dbuser&quot; = &quot;&quot; -o &quot;$dbpassword&quot; = &quot;&quot; ]; then
        exit 0
    fi

    # Set database connection environment variable
    lucky container env set &quot;CMD_DB_URL=postgres://$dbuser:$dbpassword@$dbhost:$dbport/$db_name&quot;

    lucky set-status --name db-state active

elif [ &quot;$1&quot; = &quot;leave&quot; ]; then
    lucky set-status --name db-state maintenance &quot;Disconnecting from database&quot;

    # Unset database connection environment variable
    lucky container env set &quot;CMD_DB_URL=&quot;

    lucky set-status --name db-state blocked &quot;Waiting for database connection&quot;
fi
</code></pre>
<p>And here is the section we need in the <code>lucky.yaml</code> ( still under the <code>hooks</code> section ):</p>
<pre><code class="language-yaml">  # When we are related to a database
  database-relation-joined:
    # Run our database join handler
    - host-script: handle-database-relation.sh
      args: [&quot;join&quot;]

  # When the datbase relation changes
  database-relation-changed:
    - host-script: handle-database-relation.sh
      args: [&quot;update&quot;]
  
  # When we are disconnected from a database
  database-relation-departed:
    # Run our database departed handler
    - host-script: handle-database-relation.sh
      args: [&quot;leave&quot;]
</code></pre>
<p>This is a larger chunk of code to process so lets break it down a little:</p>
<h3><a class="header" href="#joining-the-database-relation" id="joining-the-database-relation">Joining the Database Relation</a></h3>
<p>To handle the database join relation we add this section to the <code>lucky.yaml</code>:</p>
<p><strong>lucky.yaml:</strong></p>
<pre><code class="language-yaml">  # When we are related to a database
  database-relation-joined:
    # Run our database join handler
    - host-script: handle-database-relation.sh
      args: [&quot;join&quot;]
</code></pre>
<p>We say that on the <code>database-relation-joined</code> hook we want to run the <code>handle-database-relation.sh</code> script and pass it <code>join</code> as its first argument. Inside of our <code>handle-database-relation.sh</code> script we then use an if statement to check whether the first argument ( <code>$1</code> ) is <code>join</code>:</p>
<p><strong>handle-database-relation.sh:</strong></p>
<pre><code class="language-bash">if [ &quot;$1&quot; = &quot;join&quot; ]; then
    lucky set-status --name db-state maintenance &quot;Connecting to database&quot;

    # Set the name of the database that we want the server to create for us
    lucky relation set &quot;database=$db_name&quot;
</code></pre>
<p>When the database relation is joined, we set our <code>db-state</code> status to <code>&quot;Connecting to database&quot;</code>. Also, following the <a href="https://discourse.jujucharms.com/t/interface-pgsql/2393#heading-con"><code>pgsql</code> interface documentation</a>, when we join a <code>pgsql</code> relation, it is the job of our charm to set the <code>database</code> key on the relation so the PostgreSQL charm knows what database to create for our application.</p>
<p>After we have set the <code>database</code> key on this relation, we will exit and wait until the next <code>database-relation-changed</code> hook is run at which point PostgreSQL will have set the database hostname, port, username, and password that we need to connect to it.</p>
<blockquote>
<p><strong>Note:</strong> Because our script is executing as a part of a relation hook, Lucky has extra context about <em>which</em> relation to set the <code>database</code> value for and we do not need to specify <em>which</em> because it will default to whatever relation triggered the run of the relation hook.</p>
<p>If you ever needed to <code>lucky relation set</code> or <code>lucky relation get</code> <em>outside</em> of a relation hook, then you will need to specify the relation <strong>id</strong> to set/get. You will see this later when we setup the <code>http</code> relation.</p>
</blockquote>
<h3><a class="header" href="#updating-the-database-relation" id="updating-the-database-relation">Updating the Database Relation</a></h3>
<p>Now we need to handle any updates that happen to our established PostgreSQL relation:</p>
<p><strong>lucky.yaml:</strong></p>
<pre><code class="language-yaml">  # When the datbase relation changes
  database-relation-changed:
    - host-script: handle-database-relation.sh
      args: [&quot;update&quot;]
</code></pre>
<p><strong>handle-database-relation.sh:</strong></p>
<pre><code class="language-bash">elif [ &quot;$1&quot; = &quot;update&quot; ]; then
    lucky set-status --name db-state maintenance &quot;Updating database connection&quot;

    # Get the values from the connected database relation
    dbhost=&quot;$(lucky relation get host)&quot;
    dbport=&quot;$(lucky relation get port)&quot;
    dbuser=&quot;$(lucky relation get user)&quot;
    dbpassword=&quot;$(lucky relation get password)&quot;

    # If any of those values have not be set yet, exit early and wait until next update
    if [ &quot;$dbhost&quot; = &quot;&quot; -o &quot;$dbport&quot; = &quot;&quot; -o &quot;$dbuser&quot; = &quot;&quot; -o &quot;$dbpassword&quot; = &quot;&quot; ]; then
        exit 0
    fi

    # Set database connection environment variable
    lucky container env set &quot;CMD_DB_URL=postgres://$dbuser:$dbpassword@$dbhost:$dbport/$db_name&quot;

    lucky set-status --name db-state active
</code></pre>
<p>When the database relation changes, we use <code>lucky relation get</code> to get the <code>host</code>, <code>port</code>, <code>user</code>, and <code>password</code> from the PostgreSQL relation. If any of those values are not set ( i.e. equal to <code>&quot;&quot;</code> ), then we <code>exit 0</code> and wait until the next <code>database-relation-changed</code> hook until those values are set. Once all values are set, we set our <code>CMD_DB_URL</code> environment variable in the container. This will make CodiMD connect to our database.</p>
<p>Once that environment variable has been added to the container, Lucky will be sure stop, remove, and re-create the container with the new environment variable. At that point, we should have a functional CodiMD instance! Still, we've got some other code to write and we'll finish that off before we try to run our charm.</p>
<h3><a class="header" href="#leaving-the-database-relation" id="leaving-the-database-relation">Leaving the Database Relation</a></h3>
<p>Disconnecting from our database relation is simple:</p>
<p><strong>lucky.yaml:</strong></p>
<pre><code class="language-yaml">  # When we are disconnected from a database
  database-relation-departed:
    # Run our database departed handler
    - host-script: handle-database-relation.sh
      args: [&quot;leave&quot;]
</code></pre>
<p><strong>handle-database-relation.sh:</strong></p>
<pre><code class="language-bash">elif [ &quot;$1&quot; = &quot;leave&quot; ]; then
    lucky set-status --name db-state maintenance &quot;Disconnecting from database&quot;

    # Unset database connection environment variable
    lucky container env set &quot;CMD_DB_URL=&quot;

    lucky set-status --name db-state blocked &quot;Waiting for database connection&quot;
fi
</code></pre>
<h2><a class="header" href="#handling-the-website-relation" id="handling-the-website-relation">Handling the Website Relation</a></h2>
<p>Now we are ready to handle our website relation.</p>
<p>It is worth noting that our CodiMD charm could work perfectly fine without providing a <code>website</code> relation. We could just as well access our CodiMD instance over the configured port and use <code>juju expose</code> to open the firewall ports so that we can get to it. The reason that we provide a website relation with the <code>http</code> interface is so that the user could choose to deploy CodiMD behind a reverse proxy such as <a href="https://jaas.ai/haproxy">Haproxy</a> or Katharos Technology's <a href="https://jaas.ai/u/katharostech/letsencrypt-proxy">Let's Encrypt Proxy</a> charm. Providing an http relation for CodiMD makes it compatible with the larger charming ecosystem and gives the user more deployment options.</p>
<blockquote>
<p><strong>Note:</strong> On the charm store you can view a <a href="https://jaas.ai/search?provides=http">list</a> of charms that take <code>http</code> relations.</p>
</blockquote>
<p>For our <code>lucky.yaml</code> we will need to add a new section for the <code>website-relation-joined</code> hook and, like our database handler, we use an argument to the script to indicate what kind of action to perform:</p>
<p><strong>lucky.yaml:</strong></p>
<pre><code class="language-yaml">  # When a new app is related to our website relation
  website-relation-joined:
    # Run our website join handler
    - host-script : handle-website-relation.sh
      args: [&quot;join&quot;]
</code></pre>
<p>Additionally we will need to add an extra script to our existing <code>config-changed</code> hook:</p>
<pre><code class="language-yaml">  config-changed:
    # Run our configure.sh host script
    - host-script: configure.sh 
    # Update our website relations with new config
    - host-script: handle-website-relation.sh
      args: [&quot;update&quot;]
</code></pre>
<p>This is what needs to go in our <code>handle-website-relation.sh</code> script:</p>
<p><strong>handle-website-relation.sh:</strong></p>
<pre><code class="language-bash">#!/bin/bash

set -e

# Here we match on the first argument ( $1 ) passed in from the lucky.yaml

# If we are joining a new relation
if [ &quot;$1&quot; = &quot;join&quot; ]; then
    lucky set-status maintenance &quot;Joining HTTP relation&quot;

    # Set hostname and port values for the joined relation
    lucky relation set \
        &quot;hostname=$(lucky private-address)&quot; \
        &quot;port=$(lucky get-config port)&quot;

# If we are supposed to update our existing relations
elif [ &quot;$1&quot; = &quot;update&quot; ]; then
    lucky set-status maintenance &quot;Updating HTTP relations&quot;

    # For every appliacation connected to or &quot;website&quot; relation
    for relation_id in $(lucky relation list-ids --relation-name website); do
        # Set the hostname and port values for the relation
        lucky relation set --relation-id $relation_id \
            &quot;hostname=$(lucky private-address)&quot; \
            &quot;port=$(lucky get-config port)&quot;
    done
fi

lucky set-status active
</code></pre>
<p>As shown in the <a href="https://discourse.jujucharms.com/t/interface-http/2392"><code>http</code> interface documentation</a>, it is our job as the provider of an <code>http</code> relation to set the <code>hostname</code> and <code>port</code> values on our relation. In this script, we do this when we join the relation.</p>
<p>When our charm configuration changes, we have also configure in the <code>lucky.yaml</code> to run this script with the <code>update</code> arg. The goal here is to go through all of our <code>website</code> relations and <code>lucky relation set</code> the <code>hostname</code> and port to make sure it is up-to-date without our new config.</p>
<p>Note that because the <code>update</code> section of our script is triggered by the <code>config-changed</code> hook and is <strong>not</strong> a part of a relation hook, we need to get a list of all of the relation ids for our <code>website</code> relation and loop through them. For each relation id, we run <code>lucky relation set</code> and pass in the relation id. This way, any related applications that needed to know our hostname and port will be updated when our port changes.</p>
<h2><a class="header" href="#testing-our-charm" id="testing-our-charm">Testing Our Charm</a></h2>
<p>Congratulations, you have finished your first Lucky charm! That sums up everything you need to make a decent CodiMD charm with Lucky. You can find the full source for the charm <a href="https://github.com/katharostech/lucky/tree/master/docs/book/src/codimd-example-charm">here</a>. The last thing we need to do is test it. The beauty of the charm system is that, while it might be a little bit of work to write a charm, using the charm is <strong>super</strong> easy.</p>
<h3><a class="header" href="#building--deploying" id="building--deploying">Building &amp; Deploying</a></h3>
<p>Lucky charms mus be built before they can be deployed. This is very easy:</p>
<pre><code>lucky charm build
</code></pre>
<p>After that you will find the built charm in <code>./build/codimd</code>. This directory is what you need to deploy with Juju:</p>
<pre><code>juju deploy ./build/codimd
</code></pre>
<p>You will need to configure the domain and port for the codimd app before you can get to it. In this case the IP address is assumed to be the address of the server you depoyed CodiMD to. You will need to put the port in the domain as well if you are not hosting on port <code>80</code> or <code>443</code>:</p>
<pre><code>juju config codimd domain=10.176.159.221:3000 port=3000
</code></pre>
<p>After that settles our charm should show as <code>blocked</code> and &quot;Waiting for database connection&quot;. To fix that we deploy the PostgreSQL charm and relate it to our codimd charm.</p>
<pre><code>juju deploy postgresql
juju relate codimd postgresql:db
</code></pre>
<p>After PostgreSQL finishes deploying and configuring, you should be able to hit your new CodiMD instance on its IP and port. You're done!</p>
<h2><a class="header" href="#publishing-your-charm" id="publishing-your-charm">Publishing Your Charm</a></h2>
<p>OK, you were almost done, but now you want to share your charm creation with the world! To get a full guide on publishing charms to the store you can read the <a href="https://discourse.jujucharms.com/t/the-juju-charm-store/1045?u=zicklag">Juju Documentation</a>, but we'll go over the quick version here.</p>
<p>First you make sure you have built you charm:</p>
<pre><code>lucky charm build
</code></pre>
<p>Then we login to the charm store Juju's charm tools:</p>
<pre><code>charm login
</code></pre>
<p>Next we push our charm to the charm store under our account:</p>
<pre><code>$ charm push ./build/codimd codimd
cs:~username/codimd-0
</code></pre>
<blockquote>
<p><strong>Note:</strong> You cannot delete a charm from the store, once you have pushed it, without contacting the store administrators so be careful to get the charm name right the first time!</p>
</blockquote>
<p>This will push our charm to the store and print out the newly created revision of the charm. Now we release our charm to the stable channel:</p>
<pre><code>charm release cs:~username/codimd-0
</code></pre>
<p>And we grant read access to the charm to everyone:</p>
<pre><code>charm grant cs:~username/codimd everyone
</code></pre>
<p>You should now be able to see the charm in the public charm store at: <a href="https://jaas.ai/u/username/codimd/0">https://jaas.ai/u/username/codimd/0</a>.</p>
<p>Subsequent pushes of the charm will have the number at the end of the charm name incremented and they will need to be released individually to the stable channel once you have tested them:</p>
<pre><code class="language-bash"># Make changes to the charm
$ lucky charm build
$ charm push ./build/codimd codimd
cs:~username/codimd-1
$ charm release cs:~username/codimd-1
</code></pre>
<h2><a class="header" href="#wrapping-up" id="wrapping-up">Wrapping Up</a></h2>
<p>That's it for the tutorial. Very good job if you have made it this far! If you have any questions or you need help with something, do not hesitate to open a forum topic on the <a href="https://discourse.jujucharms.com/c/related-software/lucky">Juju forum</a>. We would appreciate any feedback on how Lucky worked for you or feedback on the documentation and this guide. Thank you for trying out Lucky!</p>
<h1><a class="header" href="#lucky-development" id="lucky-development">Lucky Development</a></h1>
<p>These are guides for the development of the Lucky framework itself.</p>
<ul>
<li><a href="lucky-development/./building.html">Building</a></li>
<li><a href="lucky-development/./design.html">Design</a></li>
</ul>
<h1><a class="header" href="#design" id="design">Design</a></h1>
<p>The Lucky framework will be implemented in <a href="https://www.rust-lang.org/">Rust</a> and will consist of a daemon that runs as a part of the charm and a CLI that will be used by scripts to communicate to the daemon. The overall design can be seen in the diagram below.</p>
<p><img src="lucky-development/./assets/lucky-framework.svg" alt="charm-framework-diagram" /></p>
<h2><a class="header" href="#hooks" id="hooks">Hooks</a></h2>
<p>Just like every Juju charm, Lucky charms implement a number of different hooks that the Juju controller will execute. These hooks will not be implemented by the developer but will be provided by the Lucky charm template.</p>
<h3><a class="header" href="#install" id="install">Install</a></h3>
<p>The install hook will first download one of our automated builds of the Lucky framework, which will be a standalone Rust executable. The install hook will be sure to download the binary appropriate to the platform architecture.</p>
<p>After downloading the Lucky binary it will run the Lucky daemon.</p>
<blockquote>
<p><strong>Note:</strong> The Lucky binary also acts as the CLI that is used to communicate with the running daemon.</p>
</blockquote>
<h3><a class="header" href="#other-hooks" id="other-hooks">Other Hooks</a></h3>
<p>All of the other hooks are scripts that simply use the Lucky CLI to notify the Lucky daemon of the hook's execution and of the environment variables that came with the hook execution. It is then the Lucky daemon's job to trigger the appropriate user scripts.</p>
<h2><a class="header" href="#the-lucky-daemon-and-cli" id="the-lucky-daemon-and-cli">The Lucky Daemon and CLI</a></h2>
<p>The Lucky daemon will be run by the charm install hook and will continue running for the whole duration that the charm is installed. The daemon will listen on a Unix socket for commands that will be sent to it by the Lucky CLI.</p>
<p>As noted above, the daemon will be notified for every Juju hook that is executed. It is the daemon's job to, in response to the hooks, trigger the charm developer's own scripts and to be those scripts' interface to both Docker and the Juju hook environment.</p>
<p>When a developer writes scripts for Lucky charms, instead of using the normal Juju commands such as <code>set-status</code> and <code>get-relation</code> provided by the Juju hook environment, the scripts will use the Lucky CLI. The reason for this is that scripts executed inside of the Docker container will not have access to the Juju hook environment. By mounting the Lucky daemon's socket and the Lucky CLI into the Docker container, we provide a way for scripts inside of the container to interact with the Juju hook environment. The Lucky daemon will also set helpful environment variables that can be used by the scripts, including the ones that exist in the Juju hook environment.</p>
<p>The CLI will also provide commands to configure how the container is run, such as adding environment variables, ports, starting/stopping the container, etc. The charm scripts will not themselves execute Docker commands directly, but will use the Lucky CLI instead.</p>
<h2><a class="header" href="#charm-scripts" id="charm-scripts">Charm Scripts</a></h2>
<p>The charm developer will write two kinds of scripts, host scripts and container scripts. Both kinds of are essentially similar to the normal Juju hooks and can be any executable format. All of a charms container scripts will be mounted into the Docker container and will execute inside of the container while all of the host scripts will be run on the host. The scripts will be executed by the Lucky daemon in response to the Juju hooks as outlined in a YAML file that could look something like this:</p>
<p><strong>lucky.yml:</strong></p>
<pre><code class="language-yaml">hooks:
  install:
    - host_script: do-some-host-stuff.sh
    - container_script: do-some-stuff-in-container.sh
  update-status:
    - host_script: health-check-service-from-host.sh
    - container_script: make-sure-process-in-container-is-running.py
  config-changed:
    - container_script: update-application-config.sh
</code></pre>
<p>The scripts will be executed by the Lucky daemon in the order that they are defined in the YAML.</p>
<h1><a class="header" href="#development-1" id="development-1">Development</a></h1>
<h2><a class="header" href="#building-lucky" id="building-lucky">Building Lucky</a></h2>
<p>Lucky is written in Rust and can be built with cargo by running</p>
<pre><code>cargo build --release
</code></pre>
<p>The resulting binary named <code>lucky</code> will be in <code>target/release</code>. </p>
<h2><a class="header" href="#building-documentation" id="building-documentation">Building Documentation</a></h2>
<p>The documentation is built with <a href="https://github.com/rust-lang/mdBook/">mdbook</a>. The documentation is located in the <code>docs/book</code> folder. To host the docs locally you can navigate to the <code>docs/book</code> dir and run <code>mdbook serve</code>.</p>
<h3><a class="header" href="#cli-documentation" id="cli-documentation">CLI Documentation</a></h3>
<p>In addition to the book content in <code>docs/book</code>, the CLI documentation is automatically built by Lucky and can be built by running the doc generator in the root of the project:</p>
<pre><code>cargo run --features doc-gen docs/book/src/
</code></pre>
<blockquote>
<p><strong>Warning</strong> The <code>SUMMARY.md</code> file in <code>docs/book/src</code> will be automatically updated with the CLI documentation links when the doc generator is run. Do not put any links after the <code>Lucky CLI</code> link section or it will be overwritten.</p>
</blockquote>
<h1><a class="header" href="#lucky---the-lucky-charm-framwork-for-juju" id="lucky---the-lucky-charm-framwork-for-juju">Lucky - The Lucky charm framwork for Juju</a></h1>
<p>Welcome to the Lucky CLI. Lucky is a framework for creating Juju charms. The Lucky framework is designed to make it <em><strong>easy</strong></em> and <em><strong>fun</strong></em> to write charms that are powered by Docker containers.</p>
<h2><a class="header" href="#usage" id="usage">Usage</a></h2>
<p><code>lucky [FLAGS] [SUBCOMMAND]</code></p>
<h3><a class="header" href="#subcommands" id="subcommands">Subcommands</a></h3>
<ul>
<li><a href="cli/./lucky/charm.html">charm</a>: Build and create Lucky charms</li>
<li><a href="cli/./lucky/client.html">client</a>: Communicate with Lucky and Juju in charm scripts</li>
</ul>
<h2><a class="header" href="#development-2" id="development-2">Development</a></h2>
<p>Lucky is currently under active development and is in an alpha state. Features and documentation may be missing, but we at Katharos Technology are already producing charms with Lucky that are being used in the wild. Lucky is getting real testing and solving real problems.</p>
<p>If you have any thoughts or questions please don't hesitate to <a href="https://discourse.jujucharms.com/new-topic">open a forum topic</a> in the Lucky category on the Juju forum. You can also make <a href="https://tree.taiga.io/project/zicklag-lucky/issues">feature requests or bug reports</a> on our Taiga instance.</p>
<h2><a class="header" href="#the-doc-pages-and-help" id="the-doc-pages-and-help">The Doc Pages and Help</a></h2>
<p>Most of the commands in the Lucky CLI have an extra doc page, like this one, that can be accessed with the <code>--doc</code> or <code>-H</code> flag. These will usually have extra information and examples on how to use the command.</p>
<p>Another useful thing to know is that you will get different output by using the <code>-h</code> and <code>--help</code> flags. The <code>-h</code> flag will give you more compact help output while the <code>--help</code> flag will give you more details on the available options.</p>
<h2><a class="header" href="#getting-started-2" id="getting-started-2">Getting Started</a></h2>
<p>The first step to getting started with Lucky is to create your charm using the built-in charm template.</p>
<pre><code>$ lucky charm create my-first-charm
</code></pre>
<p>You will be prompted for some basic fields that it will use to fill in the charm metadata. The doc page for <code>lucky charm create</code> has more information about what the different files in the charm are for.</p>
<p>After you have created your charm, you need to edit the <code>lucky.yaml</code> file to configure which scripts to run as a part of your charm. The charm template comes with some scripts and an example <code>lucky.yaml</code> file with comments that show the available options.</p>
<p>Once you have uncommented out the lines in the <code>lucky.yaml</code> you have to build the charm. Building the charm packages it so that it can be deployed to a Juju server or the charm store.</p>
<pre><code>$ cd my-lucky-charm
$ lucky charm build
</code></pre>
<p>The build should complete almost immediately and you can then deploy the charm to a Juju controller:</p>
<pre><code>$ juju deploy ./build/my-lucky-charm
</code></pre>
<h2><a class="header" href="#learning-more" id="learning-more">Learning More</a></h2>
<p>For a full tutorial you can read the <a href="https://katharostech.github.io/lucky/development.html">Getting Started guide</a> in the Lucky documentation.</p>
<h1><a class="header" href="#lucky-charm" id="lucky-charm">Lucky Charm</a></h1>
<p>The <code>lucky charm</code> command contains the tools you will need for charm development.</p>
<h2><a class="header" href="#usage-1" id="usage-1">Usage</a></h2>
<p><code>charm [FLAGS] [SUBCOMMAND]</code></p>
<h3><a class="header" href="#subcommands-1" id="subcommands-1">Subcommands</a></h3>
<ul>
<li><a href="cli/lucky/./charm/build.html">build</a>: Build a Lucky charm and make it ready for deployment</li>
<li><a href="cli/lucky/./charm/create.html">create</a>: Create a new lucky charm</li>
</ul>
<h2><a class="header" href="#getting-started-3" id="getting-started-3">Getting Started</a></h2>
<p>The <code>lucky charm</code> command contains tools for creating and building your charms. These are the minimal essential tools for Lucky charm developers. You can see the doc pages for the <a href="cli/lucky/./charm/create.html"><code>create</code></a> and <a href="cli/lucky/./charm/build.html"><code>build</code></a> subcommands to learn more.</p>
<h2><a class="header" href="#publishing-charms" id="publishing-charms">Publishing Charms</a></h2>
<p>In order to publish your charms to the charm store you will need the sepparate Juju <a href="https://github.com/juju/charm-tools">charm tools</a>. After you have the charm tools installed, you can push your charm to the charm store:</p>
<pre><code class="language-bash"># Build the charm using Lucky
$ lucky charm build
# Login to the charm store
$ charm login
# Push the charm to the charm store
$ charm push ./build/my-charm my-charm
</code></pre>
<p>See the Juju <a href="https://jaas.ai/docs/charm-writing/store">documentation</a> for more information about publishing charms.</p>
<h1><a class="header" href="#lucky-charm-build" id="lucky-charm-build">Lucky Charm Build</a></h1>
<p>Build a charm and make it ready for deployment.</p>
<h2><a class="header" href="#usage-2" id="usage-2">Usage</a></h2>
<p><code>build [FLAGS] [OPTIONS] [charm_dir]</code></p>
<h3><a class="header" href="#flags" id="flags">Flags</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>-l</code>, <code>--use-local-lucky</code></td><td></td><td>Build the charm bundled with the current version of Lucky. This is mostly useful during development. See "Building With Local Lucky" in the doc page.</td></tr>
</tbody>
</table>
<h3><a class="header" href="#options" id="options">Options</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>-L</code>, <code>--log-level</code><code>&lt;log_level&gt;</code></td><td></td><td>The log level to build the charm with. Build with the log level set to "trace" to get more verbose logging from Lucky while the charm is running<br /><strong>default:</strong> <code>debug</code><br /><strong>possible values:</strong> <code>trace</code>, <code>debug</code>, <code>info</code>, <code>warn</code>, <code>error</code></td></tr>
<tr><td><code>-b</code>, <code>--build-dir</code><code>&lt;build_dir&gt;</code></td><td></td><td>The directory to put the built charm in. Defaults to the "build" directory in the charm dir. The built charm will be in "build_dir/charm_name".</td></tr>
</tbody>
</table>
<h3><a class="header" href="#positionals" id="positionals">Positionals</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>&lt;charm_dir&gt;</code></td><td></td><td>The path to the charm you want to build<br /><strong>default:</strong> <code>.</code></td></tr>
</tbody>
</table>
<h2><a class="header" href="#getting-started-4" id="getting-started-4">Getting Started</a></h2>
<p>The <code>lucky charm build</code> command will take a Lucky charm and package it so that it can be deployed to a Juju server or the charm store. By default, the charm will be built to the <code>build/my-charm</code> directory and can be deployed like so:</p>
<pre><code class="language-bash">$ lucky charm build
$ juju deploy ./build/my-charm
</code></pre>
<h2><a class="header" href="#building-with-local-lucky" id="building-with-local-lucky">Building With Local Lucky</a></h2>
<p>When building with the <code>--use-local-lucky</code> or <code>-l</code> argument, Lucky will bundle the local version of Lucky that was used to build the charm into the built charm. This means that the charm will not attempt to download Lucky when it starts up and that the charm will only run on the same CPU architecture. This is mostly useful during development and only works on Linux builds made with the &quot;daemon&quot; feature.</p>
<p>If this is not specified, an automated build of Lucky for the architecture that the charm is deployed to will be automatically downloaded when the charm is installed.</p>
<h1><a class="header" href="#lucky-charm-create" id="lucky-charm-create">Lucky Charm Create</a></h1>
<p>Create a new Lucky charm from a template.</p>
<h2><a class="header" href="#usage-3" id="usage-3">Usage</a></h2>
<p><code>create [FLAGS] [OPTIONS] [target_dir]</code></p>
<h3><a class="header" href="#flags-1" id="flags-1">Flags</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>-D</code>, <code>--use-defaults</code></td><td></td><td>Do not prompt and use default values for unprovided fields</td></tr>
</tbody>
</table>
<h3><a class="header" href="#options-1" id="options-1">Options</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>-n</code>, <code>--name</code><code>&lt;charm_name&gt;</code></td><td></td><td>The name of the charm. Defaults to the target_dir</td></tr>
<tr><td><code>-d</code>, <code>--display-name</code><code>&lt;display_name&gt;</code></td><td></td><td>The display name of the charm ( may contain spaces )</td></tr>
<tr><td><code>-s</code>, <code>--summary</code><code>&lt;charm_summary&gt;</code></td><td></td><td>Short description of the charm</td></tr>
<tr><td><code>-m</code>, <code>--maintainer</code><code>&lt;charm_maintainer&gt;</code></td><td></td><td>The charm maintainer</td></tr>
</tbody>
</table>
<h3><a class="header" href="#positionals-1" id="positionals-1">Positionals</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>&lt;target_dir&gt;</code></td><td></td><td>The directory to create the charm in</td></tr>
</tbody>
</table>
<h2><a class="header" href="#getting-started-5" id="getting-started-5">Getting Started</a></h2>
<p>Running <code>lucky charm create</code> is the first step to getting started writing a Lucky charm. The command will prompt you for some basic information about your new charm and will then create all of the files necessary to get started.</p>
<h2><a class="header" href="#files" id="files">Files</a></h2>
<p>Here are the files you will need to modify to get started on your charm.</p>
<h3><a class="header" href="#metadatayaml-1" id="metadatayaml-1"><code>metadata.yaml</code></a></h3>
<p>The <code>metadata.yaml</code> file has information about the charm such as name, description, and the kind of relations it supports. The <a href="https://discourse.jujucharms.com/t/charm-metadata/1043">Juju Documentation</a> has more information on what can go in the <code>metadata.yaml</code>.</p>
<h3><a class="header" href="#configyaml-1" id="configyaml-1"><code>config.yaml</code></a></h3>
<p>The <code>config.yaml</code> file outlines the different configuration options that users can provide to the charm. This might be used for things like admin passwords, web server ports, or other similar options. More information on charm config can be found in the <a href="https://discourse.jujucharms.com/t/creating-config-yaml-and-configuring-charms/1039">Juju Config</a>.</p>
<h3><a class="header" href="#luckyyaml-1" id="luckyyaml-1"><code>lucky.yaml</code></a></h3>
<p>The <code>lucky.yaml</code> file is your &quot;control panel&quot; so to speak for what charm code gets executed when, in response to things like <a href="https://discourse.jujucharms.com/t/charm-hooks/1040">Juju hooks</a> or cron jobs. Without telling Lucky to execute your charm scripts by adding entries to the <code>lucky.yaml</code>, your charm will not do anything.</p>
<p>The example <code>lucky.yaml</code> file that comes with the charm template has commented sections indicating all of the different kinds of entries you can add to the <code>lucky.yaml</code>.</p>
<h3><a class="header" href="#host_scripts-and-container_scripts" id="host_scripts-and-container_scripts"><code>host_scripts/</code> and <code>container_scripts/</code></a></h3>
<p>These directories contiain your charm scripts which represent the charm's logic. Each of the files in these dirs should be executable and are usually shell scripts starting with a proper &quot;shabang&quot;: <code>#!/bin/bash</code>. The <code>host_scripts</code> dir contains scripts that are to be executed on the host system while <code>container_scripts</code> contains scripts that will be mounted into any containers that the charm runs.</p>
<p>These scripts will use the <code>lucky client</code> commands to interact with Juju, Lucky, and Docker. Se the <code>lucky client</code> doc page for more information.</p>
<h1><a class="header" href="#lucky-client" id="lucky-client">Lucky Client</a></h1>
<p>Interact with Juju, Lucky, and Docker in charm scripts.</p>
<h2><a class="header" href="#usage-4" id="usage-4">Usage</a></h2>
<p><code>client [FLAGS] &lt;SUBCOMMAND&gt;</code></p>
<h3><a class="header" href="#options-2" id="options-2">Options</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>-u</code>, <code>--unit-name</code><code>&lt;unit_name&gt;</code></td><td><code>JUJU_UNIT_NAME</code></td><td>The name of the Juju unit that this charm is running for. This is not required if <code>socket-path</code> has been specified.</td></tr>
<tr><td><code>-s</code>, <code>--socket-path</code><code>&lt;socket_path&gt;</code></td><td><code>LUCKY_DAEMON_SOCKET</code></td><td>The path to the daemon socket. If this is left unspecified the socket path will be automatically determined from the unit name. For example, for a unit named <code>mysql/2</code>, the socket path will be <code>/run/lucky_mysql_2.sock</code></td></tr>
</tbody>
</table>
<h3><a class="header" href="#subcommands-2" id="subcommands-2">Subcommands</a></h3>
<ul>
<li><a href="cli/lucky/./client/set-status.html">set-status</a>: Set the status of the current script</li>
<li><a href="cli/lucky/./client/kv.html">kv</a>: Get and set values in the unit key-value store</li>
<li><a href="cli/lucky/./client/container.html">container</a>: Manipulate the charm's container(s)</li>
<li><a href="cli/lucky/./client/public-address.html">public-address</a>: Get the public address of the unit</li>
<li><a href="cli/lucky/./client/private-address.html">private-address</a>: Get the private IP address of the unit</li>
<li><a href="cli/lucky/./client/get-config.html">get-config</a>: Get the charm configuration</li>
<li><a href="cli/lucky/./client/port.html">port</a>: Open and close ports on the firewall</li>
<li><a href="cli/lucky/./client/relation.html">relation</a>: Communicate over Juju relations</li>
<li><a href="cli/lucky/./client/leader.html">leader</a>: Communicate as/with unit leader</li>
<li><a href="cli/lucky/./client/random.html">random</a>: Generate random numbers and strings</li>
<li><a href="cli/lucky/./client/get-resource.html">get-resource</a>: Get the path to a Juju resource</li>
</ul>
<h2><a class="header" href="#getting-started-6" id="getting-started-6">Getting Started</a></h2>
<p>The <code>lucky client</code> command contains every command that your charm scripts can use to interact with Juju, Lucky, and Docker.</p>
<p>It is important to realize that this command is <em>only</em> used in charm scipts and as help reference for the charm developer. Also, when using this command in charm scripts, you leave out the <code>client</code> portion of the command and just use <code>lucky</code>. For example, if you locally use <code>lucky client set-status --help</code> to find out what options the <code>set-status</code> command has, when you use it in your charm scripts, you just put <code>lucky set-status</code>, without the <code>client</code>.</p>
<h1><a class="header" href="#lucky-set-status" id="lucky-set-status">Lucky Set-Status</a></h1>
<p>Set the Juju status of the script.</p>
<h2><a class="header" href="#usage-5" id="usage-5">Usage</a></h2>
<p><code>set-status [FLAGS] --name &lt;status_name&gt; [ARGS]</code></p>
<h3><a class="header" href="#options-3" id="options-3">Options</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>-n</code>, <code>--name</code><code>&lt;status_name&gt;</code></td><td><code>LUCKY_SCRIPT_ID</code></td><td>The name of the status to set: defaults to the script's name. By default, setting the status will set the status only for the current script, leaving other statuses untouched. If you specify a name for the status other scripts can change that status by specifying the same name when calling <code>set-status</code>.</td></tr>
</tbody>
</table>
<h3><a class="header" href="#positionals-2" id="positionals-2">Positionals</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>&lt;state&gt;</code></td><td></td><td>The enumerated state of the service<br /><strong>possible values:</strong> <code>active</code>, <code>waiting</code>, <code>maintenance</code>, <code>blocked</code></td></tr>
<tr><td><code>&lt;message&gt;</code></td><td></td><td>An optional message to provide with the state</td></tr>
</tbody>
</table>
<h2><a class="header" href="#usage-6" id="usage-6">Usage</a></h2>
<p><code>lucky set-status</code>, by default, will set the status <strong>for the script <em>and</em> hook combination that it is run in</strong>. This means that running <code>lucky set-status</code> in one script, will not overwrite the satus set by another script. Also, if you set the status in a script that was triggered by one hook, it will not overwrite the status set by the same script in a different hook.</p>
<p>When multiple status are set at the same time, the Juju status will be set to a comma separated list of the statuses. This means that, when multiple scripts are running at the same time, you will not have to worry about their statuses getting overwritten by other scripts that are also trying to set the status.</p>
<p>It is typical in charm scripts do something like this:</p>
<pre><code class="language-bash"># At the beginning of the script
lucky set-status maintenance &quot;Doing something&quot;

# Do stuff...

# At the end of the script
lucky set-status active
</code></pre>
<p>This will show that you are &quot;Doing something&quot; while the script is running, and then clear the status at the end of the script.</p>
<h2><a class="header" href="#setting-the-status-name" id="setting-the-status-name">Setting the Status Name</a></h2>
<p>When setting the status, you can specify the <code>--name</code> or <code>-n</code> flag to set a specific name for the status. While this name is not visible anywhere, it allows other scripts to set and override that specific status. This allows you to break out of the &quot;each script sets it own status&quot; design.</p>
<p>For example, if you set a status with the name <code>global-status</code> in an <code>install.sh</code> script, you can later change that status in another script by specifying its name.</p>
<h1><a class="header" href="#lucky-kv" id="lucky-kv">Lucky KV</a></h1>
<p>Get and set values in the unit-local key-value store.</p>
<h2><a class="header" href="#usage-7" id="usage-7">Usage</a></h2>
<p><code>kv [FLAGS] &lt;SUBCOMMAND&gt;</code></p>
<h3><a class="header" href="#subcommands-3" id="subcommands-3">Subcommands</a></h3>
<ul>
<li><a href="cli/lucky/client/./kv/get.html">get</a>: Get a value</li>
<li><a href="cli/lucky/client/./kv/set.html">set</a>: Set key-value data</li>
</ul>
<h2><a class="header" href="#usage-8" id="usage-8">Usage</a></h2>
<p>The <code>lucky kv</code> command allows you to interact with the unit's local key-value ( KV ) store. Because this KV store is local to the unit, setting a value in it will not have any effect on the KV store of any other unit in the app cluster. The KV store is a convenient way to maintain any kind of state that the charm might need to keep track of without having to read and write to files or relations.</p>
<p>They KV store will also persist across charm upgrades.</p>
<h2><a class="header" href="#examples" id="examples">Examples</a></h2>
<p><strong>Set a value:</strong></p>
<pre><code>$ lucky kv set key=value
</code></pre>
<p><strong>Set multiple values:</strong></p>
<pre><code>$ lucky kv set key1=value1 key2=value2 key3=value3
</code></pre>
<p><strong>Get a value:</strong></p>
<pre><code>$ lucky kv get key1
value1
</code></pre>
<p><strong>Get all values:</strong></p>
<pre><code>$ lucky kv get
key1=value1
key2=value2
key3=value3
</code></pre>
<p><strong>Delete a value:</strong> Delete values by setting to nothing.</p>
<pre><code>$ lucky kv set key3=</code></pre>
<h1><a class="header" href="#lucky-kv-1" id="lucky-kv-1">Lucky KV</a></h1>
<p>Get values in the unit-local key-value store.</p>
<h2><a class="header" href="#usage-9" id="usage-9">Usage</a></h2>
<p><code>get [FLAGS] [key]</code></p>
<h3><a class="header" href="#positionals-3" id="positionals-3">Positionals</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>&lt;key&gt;</code></td><td></td><td>The key to get from the store</td></tr>
</tbody>
</table>
<h2><a class="header" href="#examples-1" id="examples-1">Examples</a></h2>
<p><strong>Get a value:</strong></p>
<pre><code>$ lucky kv get key1
value1
</code></pre>
<p><strong>Get all values:</strong></p>
<pre><code>$ lucky kv get
key1=value1
key2=value2
key3=value3</code></pre>
<h1><a class="header" href="#lucky-kv-set" id="lucky-kv-set">Lucky KV Set</a></h1>
<p>Set values in the unit-local key-value store.</p>
<h2><a class="header" href="#usage-10" id="usage-10">Usage</a></h2>
<p><code>set [FLAGS] &lt;data&gt;...</code></p>
<h3><a class="header" href="#positionals-4" id="positionals-4">Positionals</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>&lt;data&gt;</code></td><td></td><td>The data to set on the relation as <code>key=value</code> pairs separated by spaces</td></tr>
</tbody>
</table>
<h2><a class="header" href="#examples-2" id="examples-2">Examples</a></h2>
<p><strong>Set a value:</strong></p>
<pre><code>$ lucky kv set key=value
</code></pre>
<p><strong>Set multiple values:</strong></p>
<pre><code>$ lucky kv set key1=value1 key2=value2 key3=value3
</code></pre>
<p><strong>Set multiple values across multiple liines:</strong></p>
<pre><code>$ lucky kv set \
    key1=value1 \
    key2=value2 \
    key3=value3
</code></pre>
<p><strong>Set values with spaces or newlines:</strong></p>
<pre><code>$ lucky kv set &quot;key=value with spaces
and newlines&quot;</code></pre>
<h1><a class="header" href="#lucky-container" id="lucky-container">Lucky Container</a></h1>
<p>Control your Lucky containers. </p>
<h2><a class="header" href="#usage-11" id="usage-11">Usage</a></h2>
<p><code>container [FLAGS] &lt;SUBCOMMAND&gt;</code></p>
<h3><a class="header" href="#subcommands-4" id="subcommands-4">Subcommands</a></h3>
<ul>
<li><a href="cli/lucky/client/./container/image.html">image</a>: Get and set the Docker image</li>
<li><a href="cli/lucky/client/./container/apply-updates.html">apply-updates</a>: Apply pending container configuration updates</li>
<li><a href="cli/lucky/client/./container/env.html">env</a>: Get and set container environment variables</li>
<li><a href="cli/lucky/client/./container/set-entrypoint.html">set-entrypoint</a>: Set the docker entrypoint</li>
<li><a href="cli/lucky/client/./container/set-command.html">set-command</a>: Set the docker command</li>
<li><a href="cli/lucky/client/./container/volume.html">volume</a>: Configure container volumes</li>
<li><a href="cli/lucky/client/./container/delete.html">delete</a>: Delete the docker container</li>
<li><a href="cli/lucky/client/./container/port.html">port</a>: Add and remove container port bindings</li>
<li><a href="cli/lucky/client/./container/set-network.html">set-network</a>: Set the docker network</li>
</ul>
<h2><a class="header" href="#getting-started-7" id="getting-started-7">Getting Started</a></h2>
<p>The <code>lucky container</code> command provides an easy way to run and modify containers as a part of your charm. Most charms will only run one container, but you can run more if desired.</p>
<p>Lucky has the concept of a &quot;default&quot; container, which is the container that is assumed to be operated on by all of the <code>lucky container</code> subcommands. Other than the default contianer there can be any number of &quot;named&quot; containers. You can specify that a <code>lucky container</code> command should run on a specific named container with the <code>--container</code> or <code>-c</code> flags.</p>
<p>The first step to setting up a container is to set the container image:</p>
<pre><code class="language-bash">$ lucky container image set nginx:latest
# Or if you wanted a named container
$ lucky container image set --container frontend nginx:latest
</code></pre>
<p>You <strong>must</strong> specify the image tag or digest when setting the image. Unlike the Docker CLI, Lucky will not assume you mean to deploy the <code>latest</code> tag if you do not specify a tag. If you fail to specify a tag you will get a Docker 404 error in the charm log and the charm script will error.</p>
<p>Once you have set the image for the container, you can use the other <code>lucky container</code> subcommands to set different attributes of the container. You can add environment variables, port bindings, and more.</p>
<pre><code># Add a port binding
$ lucky container port add 80:80
# Add an environment variable
$ lucky container env set PASSWORD=topsecret
# Add a volume
$ lucky volume add my-data:/data
</code></pre>
<blockquote>
<p><strong>Note:</strong> Not every attribute of containers can be set yet. If you have a need for a container feature that isn't there yet, it is very easy to add new ones, please <a href="https://tree.taiga.io/project/zicklag-lucky/issues">create an issue</a> and we will look into it.</p>
</blockquote>
<h2><a class="header" href="#how-containers-are-run" id="how-containers-are-run">How Containers are Run</a></h2>
<p>It is important to understand that the changes to the container configuration made with the <code>lucky container</code> subcommands do <em>not</em> happen immediately. The changes are applied <strong>after</strong> the current charm script has exited. This allows the charm to make any desired changes to the config and to wait until it is done before making the updates to the container. Lucky is smart about when to apply the Docker updates: it will not do anything if the container configuration after running the script ends up the same as it was before running the script.</p>
<p>If you need to know that your container configuration changes have been applied <em>before</em> the script exits you can use the <code>lucky container apply-updates</code> command to force Lucky to apply the container config changes.</p>
<h2><a class="header" href="#re-deployment-and-persistent-data" id="re-deployment-and-persistent-data">Re-deployment and Persistent Data</a></h2>
<p>Whenever a container config update needs to be made, the existing container, if present, will be stopped and removed and a new container will be run with the desired configuration. This means any files changes made in the container will be lost if they are not persisted in a volume. See the <a href="cli/lucky/client/./volume">volume</a> subcommand for more information on volumes.</p>
<h2><a class="header" href="#container-removal" id="container-removal">Container Removal</a></h2>
<p>All running containers will be automatically stopped and removed by Lucky when the charm is removed. You can manually delete a container in your charm logic with <code>lucky container delete</code>.</p>
<h1><a class="header" href="#lucky-container-image" id="lucky-container-image">Lucky Container Image</a></h1>
<p>Create containers and set their image.</p>
<h2><a class="header" href="#usage-12" id="usage-12">Usage</a></h2>
<p><code>image [FLAGS] [SUBCOMMAND]</code></p>
<h3><a class="header" href="#subcommands-5" id="subcommands-5">Subcommands</a></h3>
<ul>
<li><a href="cli/lucky/client/container/./image/get.html">get</a>: Get the container image</li>
<li><a href="cli/lucky/client/container/./image/set.html">set</a>: Set the container image</li>
</ul>
<h2><a class="header" href="#usage-13" id="usage-13">Usage</a></h2>
<p><code>lucky container image</code> allows you to set and get the Docker image for a container. The way you create new containers in Lucky is to set the container image with <code>lucky container image set</code>. After setting the image of the container, you can specify other settings such as environment variables and the container will be created when the script exits.</p>
<blockquote>
<p><strong>Note:</strong> The container tag or digest is <strong>required</strong> when setting the contianer image. Unlike Docker, Lucky will not assume that you mean to use the <code>latest</code> tag when you leave the tag unspecified.</p>
</blockquote>
<h2><a class="header" href="#examples-3" id="examples-3">Examples</a></h2>
<p><strong>Create a new Nginx container and bind 80 on the host:</strong></p>
<pre><code class="language-bash">$ lucky container image set nginx:latest
$ lucky container port add 80:80
</code></pre>
<h1><a class="header" href="#get" id="get">get</a></h1>
<p>Get the container image</p>
<h2><a class="header" href="#usage-14" id="usage-14">Usage</a></h2>
<p><code>get [FLAGS] [OPTIONS]</code></p>
<h3><a class="header" href="#options-4" id="options-4">Options</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>-c</code>, <code>--container</code><code>&lt;name&gt;</code></td><td></td><td>The name of the container to update. If not specified the default container will be used</td></tr>
</tbody>
</table>
<h1><a class="header" href="#set" id="set">set</a></h1>
<p>Set the container image</p>
<h2><a class="header" href="#usage-15" id="usage-15">Usage</a></h2>
<p><code>set [FLAGS] [OPTIONS] &lt;image&gt;</code></p>
<h3><a class="header" href="#flags-2" id="flags-2">Flags</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>--no-pull</code></td><td></td><td>Don't attempt to pull image before running container</td></tr>
</tbody>
</table>
<h3><a class="header" href="#options-5" id="options-5">Options</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>-c</code>, <code>--container</code><code>&lt;name&gt;</code></td><td></td><td>The name of the container to update. If not specified the default container will be used</td></tr>
</tbody>
</table>
<h3><a class="header" href="#positionals-5" id="positionals-5">Positionals</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>&lt;image&gt;</code></td><td></td><td>The container image</td></tr>
</tbody>
</table>
<h1><a class="header" href="#lucky-container-apply-updates" id="lucky-container-apply-updates">Lucky Container Apply-Updates</a></h1>
<p>Apply changes to docker configuration in the middle of a charm script.</p>
<h2><a class="header" href="#usage-16" id="usage-16">Usage</a></h2>
<p><code>apply-updates [FLAGS]</code></p>
<h2><a class="header" href="#usage-17" id="usage-17">Usage</a></h2>
<p>The <code>lucky container apply-updates</code> command is used to apply any changes that have been made to the container configuration before the current script has exited. Normally Lucky will wait until your script has exited before it applies the container configuration, but this gives you a way to make sure that the updates have applied before executing further logic.</p>
<h2><a class="header" href="#examples-4" id="examples-4">Examples</a></h2>
<pre><code class="language-bash"># Change an environment variable
lucky container env set PASSWORD=topsecret

# Apply the container configuration
lucky container apply-updates

# Continue doing stuff that depend on the container `PASSWORD` having been updated
</code></pre>
<h1><a class="header" href="#lucky-container-env" id="lucky-container-env">Lucky Container Env</a></h1>
<p>Get and set container environment variables.</p>
<h2><a class="header" href="#usage-18" id="usage-18">Usage</a></h2>
<p><code>env [FLAGS] [SUBCOMMAND]</code></p>
<h3><a class="header" href="#subcommands-6" id="subcommands-6">Subcommands</a></h3>
<ul>
<li><a href="cli/lucky/client/container/./env/get.html">get</a>: Get an environment variable</li>
<li><a href="cli/lucky/client/container/./env/set.html">set</a>: Set environment variables</li>
</ul>
<h2><a class="header" href="#examples-5" id="examples-5">Examples</a></h2>
<p><strong>Set a var:</strong></p>
<pre><code>$ lucky container env set var=value
</code></pre>
<p><strong>Set multiple vars:</strong></p>
<pre><code>$ lucky container env set var1=value1 var2=value2 var3=value3
</code></pre>
<p><strong>Set vars with spaces or newlines in it:</strong></p>
<pre><code>$ lucky container env set &quot;var1=value with space
and newline&quot;
</code></pre>
<p><strong>Get a var:</strong></p>
<pre><code>$ lucky container env get var1
value1
</code></pre>
<p><strong>Get all vars:</strong></p>
<pre><code>$ lucky container env get
var1=value1
var2=value2
var3=value3
</code></pre>
<p><strong>Delete a var:</strong> Delete values by setting to nothing.</p>
<pre><code>$ lucky container env set var3=</code></pre>
<h1><a class="header" href="#get-1" id="get-1">get</a></h1>
<p>Get an environment variable from the container. If you leave <code>key</code> unspecified, all environment variables will be printed out, one per line, in the format <code>key=value</code>.</p>
<h2><a class="header" href="#usage-19" id="usage-19">Usage</a></h2>
<p><code>get [FLAGS] [OPTIONS] [key]</code></p>
<h3><a class="header" href="#options-6" id="options-6">Options</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>-c</code>, <code>--container</code><code>&lt;name&gt;</code></td><td></td><td>The name of the container to update. If not specified the default container will be used</td></tr>
</tbody>
</table>
<h3><a class="header" href="#positionals-6" id="positionals-6">Positionals</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>&lt;key&gt;</code></td><td></td><td>The environment variable to get</td></tr>
</tbody>
</table>
<h1><a class="header" href="#set-1" id="set-1">set</a></h1>
<p>Set environment variables</p>
<h2><a class="header" href="#usage-20" id="usage-20">Usage</a></h2>
<p><code>set [FLAGS] [OPTIONS] &lt;vars&gt;...</code></p>
<h3><a class="header" href="#options-7" id="options-7">Options</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>-c</code>, <code>--container</code><code>&lt;name&gt;</code></td><td></td><td>The name of the container to update. If not specified the default container will be used</td></tr>
</tbody>
</table>
<h3><a class="header" href="#positionals-7" id="positionals-7">Positionals</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>&lt;vars&gt;</code></td><td></td><td>The vars to set on the relation as <code>key=value</code> pairs separated by spaces. Setting values to nothing will remove the environment var.</td></tr>
</tbody>
</table>
<h1><a class="header" href="#lucky-container-set-entrypoint" id="lucky-container-set-entrypoint">Lucky Container Set-Entrypoint</a></h1>
<p>Set the containers <code>entrypoint</code>.</p>
<h2><a class="header" href="#usage-21" id="usage-21">Usage</a></h2>
<p><code>set-entrypoint [FLAGS] [OPTIONS] [entrypoint]</code></p>
<h3><a class="header" href="#flags-3" id="flags-3">Flags</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>-u</code>, <code>--unset</code></td><td></td><td>Unset the entrypoint instead of setting it. The container will use the default entrypoint.</td></tr>
</tbody>
</table>
<h3><a class="header" href="#options-8" id="options-8">Options</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>-c</code>, <code>--container</code><code>&lt;name&gt;</code></td><td></td><td>The name of the container to update. If not specified the default container will be used</td></tr>
</tbody>
</table>
<h3><a class="header" href="#positionals-8" id="positionals-8">Positionals</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>&lt;entrypoint&gt;</code></td><td></td><td>The entrypoint for the container</td></tr>
</tbody>
</table>
<h2><a class="header" href="#example" id="example">Example</a></h2>
<p><strong>Set the container entry point and command so that it will <code>tail -f /dev/null</code>:</strong></p>
<pre><code class="language-bash">$ lucky container set-entrypoint tail
# Because command arg starts with a `-` it must come after a lone `-` arg
$ lucky container set-command -- -f /dev/null
</code></pre>
<h1><a class="header" href="#lucky-container-set-command" id="lucky-container-set-command">Lucky Container Set-command</a></h1>
<p>Set the containers <code>command</code>.</p>
<h2><a class="header" href="#usage-22" id="usage-22">Usage</a></h2>
<p><code>set-command [FLAGS] [OPTIONS] [command]...</code></p>
<h3><a class="header" href="#flags-4" id="flags-4">Flags</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>-u</code>, <code>--unset</code></td><td></td><td>Unset the command instead of setting it. The container will use the default command.</td></tr>
</tbody>
</table>
<h3><a class="header" href="#options-9" id="options-9">Options</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>-c</code>, <code>--container</code><code>&lt;name&gt;</code></td><td></td><td>The name of the container to update. If not specified the default container will be used</td></tr>
</tbody>
</table>
<h3><a class="header" href="#positionals-9" id="positionals-9">Positionals</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>&lt;command&gt;</code></td><td></td><td>The command for the container</td></tr>
</tbody>
</table>
<h2><a class="header" href="#examples-6" id="examples-6">Examples</a></h2>
<p>The command args must come after a <code>--</code> as shown in these examples:</p>
<p><strong>Set command to <code>echo hello</code>:</strong></p>
<pre><code>$ lucky container set-command -- echo hello
</code></pre>
<p><strong>Set command to <code>example --arg</code>:</strong></p>
<pre><code>$ lucky container set-command -- example --arg
</code></pre>
<p><strong>Set the container entry point and command so that it will <code>tail -f /dev/null</code>:</strong></p>
<pre><code>$ lucky container set-entrypoint tail
$ lucky container set-command -- -f /dev/null</code></pre>
<h1><a class="header" href="#lucky-container-volume" id="lucky-container-volume">Lucky Container Volume</a></h1>
<p>Add and remove volumes from the container.</p>
<h2><a class="header" href="#usage-23" id="usage-23">Usage</a></h2>
<p><code>volume [FLAGS] &lt;SUBCOMMAND&gt;</code></p>
<h3><a class="header" href="#subcommands-7" id="subcommands-7">Subcommands</a></h3>
<ul>
<li><a href="cli/lucky/client/container/./volume/remove.html">remove</a>: Remove a volume from the container</li>
<li><a href="cli/lucky/client/container/./volume/add.html">add</a>: Add a volume to the container</li>
<li><a href="cli/lucky/client/container/./volume/get.html">get</a>: Get the list of volumes or the source for specific volume</li>
</ul>
<h2><a class="header" href="#usage-24" id="usage-24">Usage</a></h2>
<p>The <code>lucky container volume</code> command can be used to add persistent volumes to your containers. The source for these volumes can be either an absolute path on the host or a named volume which will be automatically place in a dir in <code>/var/lib/lucky/[unit_name]/volumes/[volume_name]</code>.</p>
<blockquote>
<p><strong>Warning:</strong> Lucky does <strong>not</strong> behave the same as Docker when mounting a new named volume to a non-empty directory in the container. If you mount a new named Lucky volume to a non-empty path in the container, the contents of that directory, in the container, will be masked by the empty volume that is being mounted to that location. This is contrary to Docker's behavior where a new named volume will inherit the initial contents of the target dir.</p>
</blockquote>
<h2><a class="header" href="#examples-7" id="examples-7">Examples</a></h2>
<p><strong>Mount <code>/path/on/host</code> to <code>/data</code> in the container:</strong></p>
<pre><code>$ lucky container volume add /path/on/host /data
</code></pre>
<p><strong>Mount a volume named <code>attachments</code> to <code>/var/lib/app/attachments</code> in the container:</strong> The data will be persisted in a directory such as <code>/var/lib/lucky/my_charm_3/volumes/attachments</code> on the host.</p>
<pre><code>$ lucky container volume add attachments /var/lib/app/attachments
</code></pre>
<p><strong>Get the source path of a volume given the target path in the container:</strong></p>
<pre><code>$ lucky container volume get /data
/path/on/host
</code></pre>
<p><strong>List all of the volumes:</strong></p>
<pre><code>$ lucky container volume get
/path/on/host:/data
attachments:/var/lib/app/attachments
</code></pre>
<p><strong>Remove a volume, given the mountpoint in the container:</strong> This will <strong>not</strong> delete any data, it will just unmount it from the container.</p>
<pre><code>$ lucky container volume remove /data
</code></pre>
<p><strong>Remove a volume <em>and</em> its data:</strong> This will <em><strong>permanently delete</strong></em> any data in the volume.</p>
<pre><code>$ lucky container volume remove --delete-data /var/lib/app/attachments
</code></pre>
<h1><a class="header" href="#remove" id="remove">remove</a></h1>
<p>Remove a volume from the container</p>
<h2><a class="header" href="#usage-25" id="usage-25">Usage</a></h2>
<p><code>remove [FLAGS] [OPTIONS] [container_path]</code></p>
<h3><a class="header" href="#flags-5" id="flags-5">Flags</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>-D</code>, <code>--delete-data</code></td><td></td><td>Delete the actual backing data for the volume</td></tr>
</tbody>
</table>
<h3><a class="header" href="#options-10" id="options-10">Options</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>-c</code>, <code>--container</code><code>&lt;name&gt;</code></td><td></td><td>The name of the container to update. If not specified the default container will be used</td></tr>
</tbody>
</table>
<h3><a class="header" href="#positionals-10" id="positionals-10">Positionals</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>&lt;target&gt;</code></td><td></td><td>The absolute path in the container of the volume you want to remove.</td></tr>
</tbody>
</table>
<h1><a class="header" href="#add" id="add">add</a></h1>
<p>Add a volume to the container.</p>
<p>NOTE: This command does not exhibit the same behaviour docker does when mounting an empty volume to an non-empty directory in the container. See the doc page for more info.</p>
<h2><a class="header" href="#usage-26" id="usage-26">Usage</a></h2>
<p><code>add [FLAGS] [OPTIONS] [ARGS]</code></p>
<h3><a class="header" href="#options-11" id="options-11">Options</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>-c</code>, <code>--container</code><code>&lt;name&gt;</code></td><td></td><td>The name of the container to update. If not specified the default container will be used</td></tr>
</tbody>
</table>
<h3><a class="header" href="#positionals-11" id="positionals-11">Positionals</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>&lt;source&gt;</code></td><td></td><td>The source for the volume: either a name for a named volume or an absolute path on the host</td></tr>
<tr><td><code>&lt;target&gt;</code></td><td></td><td>The absolute path in the container to mount <code>source</code> to</td></tr>
</tbody>
</table>
<h1><a class="header" href="#get-2" id="get-2">get</a></h1>
<p>If <code>target</code> is provided and the volume exists, the source of the volume will be printed. If target is not provided, a list of volumes in the format source:target will be printed.</p>
<h2><a class="header" href="#usage-27" id="usage-27">Usage</a></h2>
<p><code>get [FLAGS] [OPTIONS] [container_path]</code></p>
<h3><a class="header" href="#options-12" id="options-12">Options</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>-c</code>, <code>--container</code><code>&lt;container&gt;</code></td><td></td><td>The name of the container to delete the environment variable for</td></tr>
</tbody>
</table>
<h3><a class="header" href="#positionals-12" id="positionals-12">Positionals</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>&lt;target&gt;</code></td><td></td><td>The absolute path, in the container, to the volume you want to get</td></tr>
</tbody>
</table>
<h1><a class="header" href="#lucky-container-delete" id="lucky-container-delete">Lucky Container Delete</a></h1>
<p>Delete a container.</p>
<h2><a class="header" href="#usage-28" id="usage-28">Usage</a></h2>
<p><code>delete [FLAGS] [OPTIONS]</code></p>
<h3><a class="header" href="#options-13" id="options-13">Options</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>-c</code>, <code>--container</code><code>&lt;name&gt;</code></td><td></td><td>The name of the container to update. If not specified the default container will be used</td></tr>
</tbody>
</table>
<h2><a class="header" href="#usage-29" id="usage-29">Usage</a></h2>
<p><code>lucky container delete</code> will remove a container. Like all <code>lucky container</code> commands, you can specify which container to delete with the <code>--container</code> flag. Also like the other <code>container</code> commands, the container will be deleted after the current script exits unless you force the update with <code>lucky container apply-updates</code>.</p>
<h2><a class="header" href="#examples-8" id="examples-8">Examples</a></h2>
<pre><code class="language-bash"># Delete the default container
lucky container delete
</code></pre>
<h1><a class="header" href="#lucky-container-port" id="lucky-container-port">Lucky Container Port</a></h1>
<p>Add, remove, and list container port bindings.</p>
<h2><a class="header" href="#usage-30" id="usage-30">Usage</a></h2>
<p><code>port [FLAGS] [SUBCOMMAND]</code></p>
<h3><a class="header" href="#subcommands-8" id="subcommands-8">Subcommands</a></h3>
<ul>
<li><a href="cli/lucky/client/container/./port/add.html">add</a>: Add a port binding</li>
<li><a href="cli/lucky/client/container/./port/remove.html">remove</a>: Remove a port binding</li>
<li><a href="cli/lucky/client/container/./port/list.html">list</a>: Get a list of the container's port bindings</li>
</ul>
<h2><a class="header" href="#usage-31" id="usage-31">Usage</a></h2>
<p><code>lucky container port</code> allows you to control which ports in the container get bound to which ports on the host.</p>
<p>It is important to understand that adding port bindings with <code>lucky container port add</code> will <em>append</em> the port binding to any existing port bindings. If you want to make sure that the contianer <em>only</em> has the bindings that you specify at a particular moment in time you must first run <code>lucky container port remove --all</code>.</p>
<h2><a class="header" href="#examples-9" id="examples-9">Examples</a></h2>
<p><strong>Bind port 80 on the host to 80 in the container:</strong></p>
<pre><code>$ lucky container port add 80:80
</code></pre>
<p><strong>Bind port 8080 on the host to 80 in the container:</strong></p>
<pre><code>$ lucky container port add 8080:80
</code></pre>
<p><strong>Remove the port binding of 80 on the host to 80 in the contianer:</strong></p>
<pre><code>$ lucky container port remove 
</code></pre>
<p><strong>Get a list of the port bindings for the container:</strong></p>
<pre><code>$ lucky container port list
80:80
443:443
</code></pre>
<p><strong>Make sure the <em>only</em> port bindings on the container are <code>80:80</code> and <code>443:443</code> :</strong></p>
<pre><code>$ lucky container port remove --all
$ lucky container port add 80:80
$ lucky container port add 443:443</code></pre>
<h1><a class="header" href="#add-1" id="add-1">add</a></h1>
<p>Add a port binding</p>
<h2><a class="header" href="#usage-32" id="usage-32">Usage</a></h2>
<p><code>add [FLAGS] [OPTIONS] [port_binding]</code></p>
<h3><a class="header" href="#options-14" id="options-14">Options</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>-c</code>, <code>--container</code><code>&lt;name&gt;</code></td><td></td><td>The name of the container to update. If not specified the default container will be used</td></tr>
</tbody>
</table>
<h3><a class="header" href="#positionals-13" id="positionals-13">Positionals</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>&lt;port_binding&gt;</code></td><td></td><td>The port binding to add in the format: <code>host_port:container_port/proto</code>. the <code>/proto</code> suffix is optional and defaults to <code>/tcp</code>.</td></tr>
</tbody>
</table>
<h1><a class="header" href="#remove-1" id="remove-1">remove</a></h1>
<p>Remove a port binding</p>
<h2><a class="header" href="#usage-33" id="usage-33">Usage</a></h2>
<p><code>remove [FLAGS] [OPTIONS] [port_binding]</code></p>
<h3><a class="header" href="#flags-6" id="flags-6">Flags</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>-A</code>, <code>--all</code></td><td></td><td>Remove all port bindings from the container</td></tr>
</tbody>
</table>
<h3><a class="header" href="#options-15" id="options-15">Options</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>-c</code>, <code>--container</code><code>&lt;name&gt;</code></td><td></td><td>The name of the container to update. If not specified the default container will be used</td></tr>
</tbody>
</table>
<h3><a class="header" href="#positionals-14" id="positionals-14">Positionals</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>&lt;port_binding&gt;</code></td><td></td><td>The port binding to remove in the format: <code>host_port:container_port/proto</code>. the <code>/proto</code> suffix is optional and defaults to <code>/tcp</code>.</td></tr>
</tbody>
</table>
<h1><a class="header" href="#list" id="list">list</a></h1>
<p>Get a list of the container's port bindings</p>
<h2><a class="header" href="#usage-34" id="usage-34">Usage</a></h2>
<p><code>list [FLAGS] [OPTIONS]</code></p>
<h3><a class="header" href="#options-16" id="options-16">Options</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>-c</code>, <code>--container</code><code>&lt;name&gt;</code></td><td></td><td>The name of the container to update. If not specified the default container will be used</td></tr>
</tbody>
</table>
<h1><a class="header" href="#lucky-container-set-network" id="lucky-container-set-network">Lucky Container Set-Network</a></h1>
<p>Set the docker network to connect the container to.</p>
<h2><a class="header" href="#usage-35" id="usage-35">Usage</a></h2>
<p><code>set-network [FLAGS] [OPTIONS] [network]</code></p>
<h3><a class="header" href="#flags-7" id="flags-7">Flags</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>-u</code>, <code>--unset</code></td><td></td><td>Unset the network instead of setting it. The container will use the default bridge network.</td></tr>
</tbody>
</table>
<h3><a class="header" href="#options-17" id="options-17">Options</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>-c</code>, <code>--container</code><code>&lt;name&gt;</code></td><td></td><td>The name of the container to update. If not specified the default container will be used</td></tr>
</tbody>
</table>
<h3><a class="header" href="#positionals-15" id="positionals-15">Positionals</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>&lt;network&gt;</code></td><td></td><td>The network for the container to use</td></tr>
</tbody>
</table>
<h2><a class="header" href="#usage-36" id="usage-36">Usage</a></h2>
<p>The <code>lucky container set-network</code> command is primarily intended to allow you to run the container in host networking mode:</p>
<pre><code>$ lucky container set-network host
</code></pre>
<p>This means that you do not need to bind any ports for the container and that any apps running inside the container will run, from a network perspective, just as they would if they were run on the host.</p>
<h1><a class="header" href="#lucky-public-address" id="lucky-public-address">Lucky Public-Address</a></h1>
<p>Get the unit's public address.</p>
<h2><a class="header" href="#usage-37" id="usage-37">Usage</a></h2>
<p><code>public-address [FLAGS]</code></p>
<h2><a class="header" href="#usage-38" id="usage-38">Usage</a></h2>
<p><code>lucky public-addresss</code> will return the public address of the current unit. The server should be accessible from the internet by the public address. Before users can connect to your app from the internet, though, you will need to open ports using <code>lucky port open</code> and the user of the charm will need to expose the app with <code>juju expose my-app</code>.</p>
<h1><a class="header" href="#lucky-private-address" id="lucky-private-address">Lucky Private-Address</a></h1>
<p>Get the unit's private address.</p>
<h2><a class="header" href="#usage-39" id="usage-39">Usage</a></h2>
<p><code>private-address [FLAGS]</code></p>
<h2><a class="header" href="#usage-40" id="usage-40">Usage</a></h2>
<p><code>lucky private-addresss</code> will return the private address of the current unit. Juju will make sure that the servers in a model will be able to communicate with each-other over their private addresses.</p>
<h1><a class="header" href="#lucky-get-config" id="lucky-get-config">Lucky Get-Config</a></h1>
<p>Get values from the charm config. </p>
<h2><a class="header" href="#usage-41" id="usage-41">Usage</a></h2>
<p><code>get-config [FLAGS] [key]</code></p>
<h3><a class="header" href="#positionals-16" id="positionals-16">Positionals</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>&lt;key&gt;</code></td><td></td><td>The config key to get. If not specified all config values will be returned, one per line, in the format <code>key=value</code>.</td></tr>
</tbody>
</table>
<h2><a class="header" href="#usage-42" id="usage-42">Usage</a></h2>
<p><code>lucky get-config</code> is used to get values from the charm configuration. The charm configuration available is defined the the charm's <code>config.yaml</code> file. This config allows users to provide input to how the should function.</p>
<p>See the <a href="https://discourse.jujucharms.com/t/creating-config-yaml-and-configuring-charms/1039">Juju documentation</a> for more information on the <code>config.yaml</code> file.</p>
<h2><a class="header" href="#examples-10" id="examples-10">Examples</a></h2>
<p><strong>Get the <code>my-app-version</code> config:</strong></p>
<pre><code>$ lucky get-config my-app-version
1.33.4
</code></pre>
<p>This assumes that there is a <code>my-app-version</code> config in the <code>config.yaml</code> file, which could look something like this:</p>
<p><strong><code>config.yaml</code></strong>:</p>
<pre><code class="language-yaml">options:
  my-app-version:
    type: string
    default: 1.33.0
    description: The version of My App to install
</code></pre>
<h1><a class="header" href="#lucky-port" id="lucky-port">Lucky Port</a></h1>
<p>Open and close ports on the host firewall.</p>
<h2><a class="header" href="#usage-43" id="usage-43">Usage</a></h2>
<p><code>port [FLAGS] &lt;SUBCOMMAND&gt;</code></p>
<h3><a class="header" href="#subcommands-9" id="subcommands-9">Subcommands</a></h3>
<ul>
<li><a href="cli/lucky/client/./port/open.html">open</a>: Open a port on the firewall</li>
<li><a href="cli/lucky/client/./port/close.html">close</a>: Close a port on the firewall</li>
<li><a href="cli/lucky/client/./port/get-opened.html">get-opened</a>: Get the ports opened by this charm</li>
</ul>
<h2><a class="header" href="#usage-44" id="usage-44">Usage</a></h2>
<p>The <code>lucky port</code> command allows you to <code>open</code>, <code>close</code>, and <code>get-opened</code> ports on the host firewall.</p>
<blockquote>
<p><strong>Note:</strong> Juju will not actually expose the opened firewall ports unless the user deploying the charm exposes it using <code>juju expose my-app</code>. In this way, apps are not accidentally exposed to the internet without the user meaning to.</p>
</blockquote>
<h2><a class="header" href="#examples-11" id="examples-11">Examples</a></h2>
<p><strong>Make sure your configured port is the only port opened:</strong></p>
<pre><code class="language-bash"># Make sure any previously opened ports are closed
$ lucky port close --all
# Open the new ports
$ lucky port open $(lucky get-config listen-port)
</code></pre>
<h1><a class="header" href="#open" id="open">open</a></h1>
<p>Open a port on the firewall. A port range may be specified with an optional protocol as well ( TCP is default ). Example values: <code>8000-9000/udp</code>, <code>9000</code>.</p>
<h2><a class="header" href="#usage-45" id="usage-45">Usage</a></h2>
<p><code>open [FLAGS] &lt;port&gt;</code></p>
<h3><a class="header" href="#positionals-17" id="positionals-17">Positionals</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>&lt;port&gt;</code></td><td></td><td>The port to open</td></tr>
</tbody>
</table>
<h1><a class="header" href="#close" id="close">close</a></h1>
<p>Close a port on the firewall. A port range may be specified with an optional protocol as well ( TCP is default ). Example values: <code>8000-9000/udp</code>, <code>9000</code>.</p>
<h2><a class="header" href="#usage-46" id="usage-46">Usage</a></h2>
<p><code>close [FLAGS] [port]</code></p>
<h3><a class="header" href="#flags-8" id="flags-8">Flags</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>-A</code>, <code>--all</code></td><td></td><td>Remove all port rules</td></tr>
</tbody>
</table>
<h3><a class="header" href="#positionals-18" id="positionals-18">Positionals</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>&lt;port&gt;</code></td><td></td><td>The port to close</td></tr>
</tbody>
</table>
<h1><a class="header" href="#get-opened" id="get-opened">get-opened</a></h1>
<p>Get the ports opened by this charm. This will return a line for each port or port range that has been opened in the format: <code>port-or-range/protocol</code>. For exmaple:</p>
<p>8000/tcp
10000-11000/udp</p>
<h2><a class="header" href="#usage-47" id="usage-47">Usage</a></h2>
<p><code>get-opened [FLAGS]</code></p>
<h1><a class="header" href="#lucky-relation" id="lucky-relation">Lucky Relation</a></h1>
<p>Communicate over Juju relations. </p>
<h2><a class="header" href="#usage-48" id="usage-48">Usage</a></h2>
<p><code>relation [FLAGS] &lt;SUBCOMMAND&gt;</code></p>
<h3><a class="header" href="#subcommands-10" id="subcommands-10">Subcommands</a></h3>
<ul>
<li><a href="cli/lucky/client/./relation/get.html">get</a>: Get data from a relation</li>
<li><a href="cli/lucky/client/./relation/set.html">set</a>: Set local values on a relation</li>
<li><a href="cli/lucky/client/./relation/list-units.html">list-units</a>: List the units collected to a relation</li>
<li><a href="cli/lucky/client/./relation/list-ids.html">list-ids</a>: List relation ids connected to this unit</li>
</ul>
<h2><a class="header" href="#understanding-relations" id="understanding-relations">Understanding Relations</a></h2>
<p>The <code>lucky relation</code> command has all of the tools that you need to interact with Juju's concept of relations. Relations are a somwhat complicated concept to grasp but they are probably the most important concept in Juju and they are what powers Juju's ability to deploy apps in a conceptually simple manner.</p>
<p>Juju relations allow the units on each side of a relation to <em>set</em> values on their side of the relation that can be <em>read</em> by the unit on the other side. A unit can <code>set</code> and <code>get</code> values on its own side of the relation, but it can only <code>get</code> values from the other side of the relation.</p>
<p>While we hope to provide more documentation on using relations later, currently the best reference is the <a href="https://discourse.jujucharms.com/t/the-hook-environment-hook-tools-and-how-hooks-are-run/1047#heading--relation-get">Juju documentation</a>. The lucky relation commands serve the same functions as the built-in Juju hook tools. The mappings are as follows:</p>
<table><thead><tr><th align="left"><strong>Lucky Command</strong></th><th align="left"><strong>Juju Command</strong></th></tr></thead><tbody>
<tr><td align="left"><code>lucky relation set</code></td><td align="left"><code>relation-set</code></td></tr>
<tr><td align="left"><code>lucky relation get</code></td><td align="left"><code>relation-get</code></td></tr>
<tr><td align="left"><code>lucky relation list-ids</code></td><td align="left"><code>relation-ids</code></td></tr>
<tr><td align="left"><code>lucky relation list-units</code></td><td align="left"><code>relation-list</code></td></tr>
</tbody></table>
<h2><a class="header" href="#examples-12" id="examples-12">Examples</a></h2>
<p><strong>Iterating over charm relations:</strong></p>
<p>This will work inside or outside of a <code>relation-*</code> hook.</p>
<pre><code class="language-bash">servers=&quot;&quot;
# For each related application in the `http` relation
for relation_id in $(lucky relation list-ids --relation-name http); do
    
    # For every unit of that application
    for related_unit in $(lucky relation list-units -r $relation_id); do
        
        # Get the unit's hostname
        addr=$(lucky relation get -r $relation_id -u $related_unit hostname)
        
        # Get the unit's port
        port=$(lucky relation get -r $relation_id -u $related_unit port)
        
        # Add it to the server list
        servers=&quot;$servers $addr:$port&quot;

        # You can also set values on your side of the relation
        lucky relation set -r $relation_id -u $related_unit key=value
    done

    # You can also get the values that you have set on this relation by specifying
    # your unit name ( from the $JUJU_UNIT_NAME env var ) as the -u argument
    lucky relation get -r $relation_id -u $JUJU_UNIT_NAME hostname
done
</code></pre>
<hr />
<p><strong>Get the hostname and port of a related unit in a <code>http-relation-changed</code> hook:</strong></p>
<p>In this example, because we are in a <code>http-relation-changed</code> hook, we don't have to specify the relation id or the related unit. Those are set in environment variables by Juju and the <code>lucky relation get</code> command will automatically default to getting from the relation and unit that triggered the <code>relation-changed</code> hook.</p>
<pre><code class="language-bash">hostname=$(lucky relation get hostname)
port=$(lucky relation get port)
</code></pre>
<p>You can also set data on relations in hooks in the same way.</p>
<pre><code class="language-bash">lucky relation set user=my-username
</code></pre>
<h1><a class="header" href="#get-3" id="get-3">get</a></h1>
<p>Get data from a relation</p>
<h2><a class="header" href="#usage-49" id="usage-49">Usage</a></h2>
<p><code>get [FLAGS] [OPTIONS] [key]</code></p>
<h3><a class="header" href="#flags-9" id="flags-9">Flags</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>-A</code>, <code>--app</code></td><td></td><td>Get application relation data instead of unit relation data</td></tr>
</tbody>
</table>
<h3><a class="header" href="#options-18" id="options-18">Options</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>-r</code>, <code>--relation-id</code><code>&lt;relation_id&gt;</code></td><td></td><td>The relation id to get the data from</td></tr>
<tr><td><code>-u</code>, <code>--remote-unit</code><code>&lt;remote_unit_name&gt;</code></td><td></td><td>The name of the remote unit to get data from</td></tr>
</tbody>
</table>
<h3><a class="header" href="#positionals-19" id="positionals-19">Positionals</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>&lt;key&gt;</code></td><td></td><td>Optional key to get from the data</td></tr>
</tbody>
</table>
<h1><a class="header" href="#set-2" id="set-2">set</a></h1>
<p>Set local values on a relation</p>
<h2><a class="header" href="#usage-50" id="usage-50">Usage</a></h2>
<p><code>set [FLAGS] [OPTIONS] &lt;data&gt;...</code></p>
<h3><a class="header" href="#flags-10" id="flags-10">Flags</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>-A</code>, <code>--app</code></td><td></td><td>Set application relation data instead of unit relation data. the unit must be the leader unit to set application relation data</td></tr>
</tbody>
</table>
<h3><a class="header" href="#options-19" id="options-19">Options</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>-r</code>, <code>--relation-id</code><code>&lt;relation_id&gt;</code></td><td></td><td>The relation id to get the data from</td></tr>
</tbody>
</table>
<h3><a class="header" href="#positionals-20" id="positionals-20">Positionals</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>&lt;data&gt;</code></td><td></td><td>The data to set on the relation as <code>key=value</code> pairs separated by spaces</td></tr>
</tbody>
</table>
<h1><a class="header" href="#list-units" id="list-units">list-units</a></h1>
<p>List the units collected to a relation</p>
<h2><a class="header" href="#usage-51" id="usage-51">Usage</a></h2>
<p><code>list-units [FLAGS] [OPTIONS]</code></p>
<h3><a class="header" href="#options-20" id="options-20">Options</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>-r</code>, <code>--relation-id</code><code>&lt;relation_id&gt;</code></td><td></td><td>The relation id to list the connected units for</td></tr>
</tbody>
</table>
<h1><a class="header" href="#list-ids" id="list-ids">list-ids</a></h1>
<p>List relation ids connected to this unit</p>
<h2><a class="header" href="#usage-52" id="usage-52">Usage</a></h2>
<p><code>list-ids [FLAGS] [OPTIONS]</code></p>
<h3><a class="header" href="#options-21" id="options-21">Options</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>-n</code>, <code>--relation-name</code><code>&lt;relation_name&gt;</code></td><td></td><td>The specific name of the relation ( from the metadata.yaml )</td></tr>
</tbody>
</table>
<h1><a class="header" href="#lucky-leader" id="lucky-leader">Lucky Leader</a></h1>
<p>Interact with the Juju leader system.</p>
<h2><a class="header" href="#usage-53" id="usage-53">Usage</a></h2>
<p><code>leader [FLAGS] &lt;SUBCOMMAND&gt;</code></p>
<h3><a class="header" href="#subcommands-11" id="subcommands-11">Subcommands</a></h3>
<ul>
<li><a href="cli/lucky/client/./leader/get.html">get</a>: Get data from the leader unit</li>
<li><a href="cli/lucky/client/./leader/set.html">set</a>: Set values as the leader charm</li>
<li><a href="cli/lucky/client/./leader/is-leader.html">is-leader</a>: Get whether or not this unit is the leader unit</li>
</ul>
<h2><a class="header" href="#usage-54" id="usage-54">Usage</a></h2>
<p>The <code>lucky leader</code> command provides a way to interract with Juju's leader system. You can <code>get</code>, <code>set</code>, and check whether or not the current user <code>is-leader</code>.</p>
<p>The leader unit, elected by Juju, is allowed to set key-value pair using <code>lucky leader set</code> and all of the units in the app are able to read key-value pairs from the leader by using <code>lucky leader get</code>. See the <a href="https://discourse.jujucharms.com/t/implementing-leadership/1124">Juju documentation</a> for more information on how to use leadership in Juju.</p>
<h2><a class="header" href="#examples-13" id="examples-13">Examples</a></h2>
<p><strong>Set a random password if the unit is the leader:</strong></p>
<pre><code class="language-bash">if [ &quot;$(lucky leader is-leader)&quot; = &quot;true&quot; ]; then
    lucky leader set password=$(lucky random)
fi
</code></pre>
<p><strong>Get the password from the leader unit:</strong></p>
<pre><code class="language-bash">$ lucky leader get password
</code></pre>
<p><strong>Set multiple leader values:</strong></p>
<pre><code class="language-bash">$ lucky leader set \
    user=username \
    password=topsecret
</code></pre>
<h1><a class="header" href="#get-4" id="get-4">get</a></h1>
<p>Get data from the leader unit</p>
<h2><a class="header" href="#usage-55" id="usage-55">Usage</a></h2>
<p><code>get [FLAGS] [key]</code></p>
<h3><a class="header" href="#positionals-21" id="positionals-21">Positionals</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>&lt;key&gt;</code></td><td></td><td>Optional key to get from the data</td></tr>
</tbody>
</table>
<h1><a class="header" href="#set-3" id="set-3">set</a></h1>
<p>Set values as the leader charm</p>
<h2><a class="header" href="#usage-56" id="usage-56">Usage</a></h2>
<p><code>set [FLAGS] &lt;data&gt;...</code></p>
<h3><a class="header" href="#positionals-22" id="positionals-22">Positionals</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>&lt;data&gt;</code></td><td></td><td>The data to set as the leader as <code>key=value</code> pairs separated by spaces</td></tr>
</tbody>
</table>
<h1><a class="header" href="#is-leader" id="is-leader">is-leader</a></h1>
<p>Get whether or not this unit is the leader unit. Returns &quot;true&quot; if unit is leader and &quot;false&quot; if it is not.</p>
<h2><a class="header" href="#usage-57" id="usage-57">Usage</a></h2>
<p><code>is-leader [FLAGS]</code></p>
<h1><a class="header" href="#lucky-random" id="lucky-random">Lucky Random</a></h1>
<p>Generate random passwords, numbers, and available ports.</p>
<h2><a class="header" href="#usage-58" id="usage-58">Usage</a></h2>
<p><code>random [FLAGS] [OPTIONS]</code></p>
<h3><a class="header" href="#flags-11" id="flags-11">Flags</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>-p</code>, <code>--available-port</code></td><td></td><td>Get a random available port. This may be combined with --range to get a random available port in the given range. The default port range is 1024-65535. If an available port cannot be found in the given range the nextavailable port starting at 1024 will be selected</td></tr>
<tr><td><code>-f</code>, <code>--float</code></td><td></td><td>Generate a floating point range instead of an integer range</td></tr>
</tbody>
</table>
<h3><a class="header" href="#options-22" id="options-22">Options</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>-r</code>, <code>--range</code><code>&lt;lowest_number&gt; &lt;highest_number&gt;</code></td><td></td><td>Generate a random integer in a range</td></tr>
<tr><td><code>-l</code>, <code>--length</code><code>&lt;length&gt;</code></td><td></td><td>Set the length of the generated string</td></tr>
</tbody>
</table>
<h2><a class="header" href="#usage-59" id="usage-59">Usage</a></h2>
<p><code>lucky random</code> is a utility for generating passwords, number ranges, and for getting random available ports.</p>
<h2><a class="header" href="#examples-14" id="examples-14">Examples</a></h2>
<p><strong>Generate a random password with a specified length:</strong></p>
<pre><code>$ lucky random --length 32
</code></pre>
<p><strong>Generate a random integer between 0 and 10 inclusive:</strong></p>
<pre><code>$ lucky random --range 0 10
</code></pre>
<p><strong>Generate a random float between 0 and 1:</strong></p>
<pre><code>$ lucky random --float --range 0 1
</code></pre>
<p><strong>Find a random available port in between <code>1024</code> and <code>65535</code>:</strong></p>
<pre><code>$ lucky random --available-port
</code></pre>
<h1><a class="header" href="#lucky-get-resource" id="lucky-get-resource">Lucky Get-Resource</a></h1>
<p>Get the path to a Juju resource. </p>
<h2><a class="header" href="#usage-60" id="usage-60">Usage</a></h2>
<p><code>get-resource [FLAGS] [resource_name]</code></p>
<h3><a class="header" href="#positionals-23" id="positionals-23">Positionals</a></h3>
<table>
<thead><tr><th>Arg</th><th>Environment Variable</th><th>Description</th><tr></thead>
<tbody>
<tr><td><code>&lt;resource_name&gt;</code></td><td></td><td>The name of the resource to get as defined in the metadata.yaml file</td></tr>
</tbody>
</table>
<h2><a class="header" href="#usage-61" id="usage-61">Usage</a></h2>
<p>This command is the direct equivalent to Juju's <a href="https://discourse.jujucharms.com/t/using-resources-developer-guide/1127#heading--using-resources-in-a-charm"><code>resource-get</code></a> command. Refer to that documentation for more information on how Juju resources work.</p>
<p>This command will exit non-zero if the resource has not been uploaded yet.</p>
<h2><a class="header" href="#example-1" id="example-1">Example</a></h2>
<p><strong>Make sure a resource exists before getting the path to it:</strong></p>
<pre><code class="language-bash">if ! lucky get-resource resource-name; then
    lucky set-status blocked &quot;Need resource-name to be uploaded&quot;
else
    path_to_resource=$(lucky get-resource resource-name)
fi
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        
        
        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
